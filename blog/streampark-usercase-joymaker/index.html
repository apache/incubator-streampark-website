<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Apache StreamPark™ Cloud Native Platform Practice at Joymaker | Apache StreamPark (incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://streampark.apache.org/blog/streampark-usercase-joymaker"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Apache StreamPark™ Cloud Native Platform Practice at Joymaker | Apache StreamPark (incubating)"><meta data-rh="true" name="description" content="Introduction: This article mainly introduces Joymaker&#x27;s application of big data technology architecture in practice, and explains why Joymaker chose &quot;Kubernetes + StreamPark&quot; to continuously optimise and enhance the existing architecture. It not only systematically describes how to deploy and apply these key technologies in the actual environment, but also explains the practical use of StreamPark in depth, emphasising the perfect integration of theory and practice. I believe that by reading this article, readers will help to understand and master the relevant technologies, and will be able to make progress in practice, which will lead to significant learning results."><meta data-rh="true" property="og:description" content="Introduction: This article mainly introduces Joymaker&#x27;s application of big data technology architecture in practice, and explains why Joymaker chose &quot;Kubernetes + StreamPark&quot; to continuously optimise and enhance the existing architecture. It not only systematically describes how to deploy and apply these key technologies in the actual environment, but also explains the practical use of StreamPark in depth, emphasising the perfect integration of theory and practice. I believe that by reading this article, readers will help to understand and master the relevant technologies, and will be able to make progress in practice, which will lead to significant learning results."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-10-18T07:44:07.000Z"><meta data-rh="true" property="article:tag" content="StreamPark,Production Practice"><link data-rh="true" rel="icon" href="/image/favicon.ico"><link data-rh="true" rel="canonical" href="https://streampark.apache.org/blog/streampark-usercase-joymaker"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/blog/streampark-usercase-joymaker" hreflang="en"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/zh-CN/blog/streampark-usercase-joymaker" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/blog/streampark-usercase-joymaker" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache StreamPark (incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache StreamPark (incubating) Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2815dd1e.css">
<script src="/assets/js/runtime~main.788200c2.js" defer="defer"></script>
<script src="/assets/js/main.237a4499.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_BCtO" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/image/logo.png" alt="StreamPark Logo" class="themedComponent_Cvhi themedComponent--light_uT2j"><img src="/image/logo.png" alt="StreamPark Logo" class="themedComponent_Cvhi themedComponent--dark_ENih"></div><b class="navbar__title text--truncate">StreamPark</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/get-started/intro">Docs</a><a class="navbar__item navbar__link" href="/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of conduct</a></li><li><a class="dropdown__link" href="/community/contribution_guide/mailing_lists">Join the mailing lists</a></li><li><a class="dropdown__link" href="/community/contribution_guide/become_committer">Become A Committer</a></li><li><a class="dropdown__link" href="/community/contribution_guide/become_pmc_member">Become A PMC member</a></li><li><a class="dropdown__link" href="/community/contribution_guide/new_committer_process">New Committer Process</a></li><li><a class="dropdown__link" href="/community/contribution_guide/new_pmc_ember_process">New PMC Member Process</a></li><li><a class="dropdown__link" href="/community/submit_guide/document">Documentation Notice</a></li><li><a class="dropdown__link" href="/community/submit_guide/submit_code">Submit Code</a></li><li><a class="dropdown__link" href="/community/submit_guide/code_style_and_quality_guide">Code style and quality guide</a></li><li><a class="dropdown__link" href="/community/submit_guide/documentation_style_guide">Documentation style guide</a></li><li><a class="dropdown__link" href="/community/release/how_to_release_version_2.1.x">How to release version 2.1.x</a></li><li><a class="dropdown__link" href="/community/release/how_to_verify_release">How to Verify Release</a></li></ul></div><a class="navbar__item navbar__link" href="/team">Team</a><a class="navbar__item navbar__link" href="/user">Users</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://github.com/apache/incubator-streampark/issues/507" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">FAQ</a><a href="https://github.com/apache/incubator-streampark" target="_blank" class="githubStars_qnS9"><div class="githubStarsContainer_O7dk"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1.75C4.27062 1.75 1.25 4.77062 1.25 8.5C1.25 11.4869 3.18219 14.0097 5.86531 14.9041C6.20281 14.9631 6.32937 14.7606 6.32937 14.5834C6.32937 14.4231 6.32094 13.8916 6.32094 13.3263C4.625 13.6384 4.18625 12.9128 4.05125 12.5331C3.97531 12.3391 3.64625 11.74 3.35938 11.5797C3.12312 11.4531 2.78562 11.1409 3.35094 11.1325C3.8825 11.1241 4.26219 11.6219 4.38875 11.8244C4.99625 12.8453 5.96656 12.5584 6.35469 12.3813C6.41375 11.9425 6.59094 11.6472 6.785 11.4784C5.28312 11.3097 3.71375 10.7275 3.71375 8.14563C3.71375 7.41156 3.97531 6.80406 4.40563 6.33156C4.33812 6.16281 4.10187 5.47094 4.47312 4.54281C4.47312 4.54281 5.03844 4.36563 6.32937 5.23469C6.86937 5.08281 7.44313 5.00687 8.01688 5.00687C8.59063 5.00687 9.16438 5.08281 9.70438 5.23469C10.9953 4.35719 11.5606 4.54281 11.5606 4.54281C11.9319 5.47094 11.6956 6.16281 11.6281 6.33156C12.0584 6.80406 12.32 7.40312 12.32 8.14563C12.32 10.7359 10.7422 11.3097 9.24031 11.4784C9.485 11.6894 9.69594 12.0944 9.69594 12.7272C9.69594 13.63 9.6875 14.3556 9.6875 14.5834C9.6875 14.7606 9.81406 14.9716 10.1516 14.9041C12.8178 14.0097 14.75 11.4784 14.75 8.5C14.75 4.77062 11.7294 1.75 8 1.75Z" fill="currentColor"></path></svg><span class="githubText_YlX6">3.9k</span></div></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg></a><ul class="dropdown__menu"><li><a href="/blog/streampark-usercase-joymaker" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-CN/blog/streampark-usercase-joymaker" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div><a class="colorModeButton_yITp undefined"><svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"></path></svg></a><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_SuYZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_HgBb searchBarLoadingRing_om0w"><div></div><div></div><div></div><div></div></div></div></div><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_pmYA"><div class="container-wrapper blog-container"><div class="container margin-vert--lg"><div class="row"><aside class="col col--2 overflow-hidden" style="opacity:0;transform:translateX(-100px) translateZ(0)"><nav class="sidebar_brwN thin-scrollbar" aria-label="Blog recent posts navigation"><div class="backButton_MCHS"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M8 7v4L2 6l6-5v4h5a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12H8Z"></path></svg></div><a class="sidebarItemTitle_r4Q1 margin-bottom--sm" href="/blog">近期文章</a><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-flink-on-k8s">Apache StreamPark™ Flink on Kubernetes practice</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/flink-development-framework-streampark">Apache StreamPark™ - Powerful Flink Development Framework</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-flink-with-paimon-in-ziru">Ziroom implements the best practice of one-key data input into the lake based on Apache StreamPark™ + Paimon</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-tianyancha">Apache StreamPark™ helps Tianyancha real-time platform construction｜Multiple-fold increase in efficiency</a></li><li class="sidebarItem_lnhn"><a aria-current="page" class="sidebarItemLink_yNGZ sidebarItemLinkActive_oSRm" href="/blog/streampark-usercase-joymaker">Apache StreamPark™ Cloud Native Platform Practice at Joymaker</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-chinaunion">China Union&#x27;s Flink Real-Time Computing Platform Ops Practice</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-bondex-with-paimon">Based on Apache Paimon + Apache StreamPark™&#x27;s Streaming Data Warehouse Practice by Bondex</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-shunwang">Apache StreamPark™ in the Large-Scale Production Practice at Shunwang Technology</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-dustess">Apache StreamPark™&#x27;s Best Practices at Dustess, Simplifying Complexity for the Ultimate Experience</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-joyme">Apache StreamPark™&#x27;s Production Practice in Joyme</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-haibo">An All-in-One Computation Tool in Haibo Tech&#x27;s Production Practice and facilitation in Smart City Construction</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-ziru">Ziroom&#x27;s Real-Time Computing Platform Practice Based on Apache StreamPark™</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/streampark-usercase-changan">Changan Automobile’s upgrade practice from self-developed platform to Apache StreamPark™</a></li></ul></nav></aside><main class="col col--8 overflow-hidden" itemscope="" itemtype="http://schema.org/Blog"><div><div class="row" style="margin:0"><div class="col col--12 article__details article-bg"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Introduction: This article mainly introduces Joymaker&#x27;s application of big data technology architecture in practice, and explains why Joymaker chose &quot;Kubernetes + StreamPark&quot; to continuously optimise and enhance the existing architecture. It not only systematically describes how to deploy and apply these key technologies in the actual environment, but also explains the practical use of StreamPark in depth, emphasising the perfect integration of theory and practice. I believe that by reading this article, readers will help to understand and master the relevant technologies, and will be able to make progress in practice, which will lead to significant learning results."><header><h1 class="margin-bottom--md blogPostTitle_thoQ text--center post--titleLink" itemprop="headline">Apache StreamPark™ Cloud Native Platform Practice at Joymaker</h1><div class="margin-vert--md"><time datetime="2024-10-18T07:44:07.000Z" itemprop="datePublished"></time> · <!-- -->30 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><img decoding="async" loading="lazy" src="/assets/images/new_cover-4a6114b4487e3e397951de8ff4abe8f9.png" width="1080" height="460" class="img__KcZ"></p>
<p><strong>Introduction</strong>: This article mainly introduces Joymaker&#x27;s application of big data technology architecture in practice, and explains why Joymaker chose &quot;Kubernetes + StreamPark&quot; to continuously optimise and enhance the existing architecture. It not only systematically describes how to deploy and apply these key technologies in the actual environment, but also explains the practical use of StreamPark in depth, emphasising the perfect integration of theory and practice. I believe that by reading this article, readers will help to understand and master the relevant technologies, and will be able to make progress in practice, which will lead to significant learning results.</p>
<p>Github: <a href="https://github.com/apache/streampark" target="_blank" rel="noopener noreferrer">https://github.com/apache/streampark</a></p>
<p>Welcome to follow, Star, Fork and participate in contributing!</p>
<p>Contributed by | Joymaker</p>
<p>Author | Du Yao</p>
<p>Article Organiser | Yang Linwei</p>
<p>Proofreader | Pan Yuepeng</p>
<p>Joymaker, is a global game development and publishing company; the company&#x27;s products focus on two categories: MMORPG and MMOACT; Joy&#x27;s product philosophy: &quot;It is better to make a product that 100 people scream than a product that 10,000 people applaud&quot;; Joy&#x27;s products are always of high quality. RO Legend of Wonderland: Love is Like the First Time&quot; was launched in Southeast Asia, and reached the milestone of 10 million reservations during the booking period, achieved the first place in the best-seller list of five countries on the first day of the launch, and was released in Japan, Korea, the United States, Hong Kong, Macao, Taiwan, and other places, and has achieved good results.</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="1-operational-context-and-challenges"><strong>1. Operational Context and Challenges</strong><a href="#1-operational-context-and-challenges" class="hash-link" aria-label="Direct link to 1-operational-context-and-challenges" title="Direct link to 1-operational-context-and-challenges">​</a></h2>
<p>The big data base currently used by Joymaker Entertainment is Tencent Cloud&#x27;s EMR, and the number warehouse architecture is mainly divided into the following categories:</p>
<ul>
<li>
<p><strong>Offline Warehouse Architecture</strong>: Hadoop + Hive + Dolphinscheduler + Trino</p>
</li>
<li>
<p><strong>Real-time Warehouse Architecture</strong>: Kafka + Flink + StreamPark + Doris</p>
</li>
<li>
<p><strong>Streaming Warehouse Architecture (in planning)</strong>: Paimon + Flink + StreamPark + Doris</p>
</li>
</ul>
<p>Among them, the streaming warehouse architecture is one of our key plans for 2024, with the goal of improving big data analytics and the value output of various data products based on the elasticity feature of Kubernetes. However, due to earlier architectural reasons (mainly the mixed deployment of Apache Doris and EMR core nodes), it made us encounter many problems, such as:</p>
<ul>
<li>
<p><strong>Resource contention</strong>: Under the YARN resource scheduling platform, Apache Doris, Apache Flink real-time tasks, Hive&#x27;s offline tasks, and Spark&#x27;s SQL tasks often contend for CPU and memory resources, resulting in Doris query stability degradation and frequent query errors.</p>
</li>
<li>
<p><strong>Insufficient resources</strong>: YARN&#x27;s machine resource usage rate is between 70% and 80% most of the time, especially in the scenario of a large number of complements, the cluster resources are often insufficient.</p>
</li>
<li>
<p><strong>Manual Intervention</strong>: Real-time Flink has more and more tasks, the data of each game has obvious peaks and valleys changes in a day, especially the hangout activities carried out on weekends, the data volume doubles, and even increases to more than 10 billion entries per day, and this requires frequent manual adjustment of parallelism to adapt to the computational pressure in order to ensure the data consumption capacity.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="2-solution-selection"><strong>2. Solution Selection</strong><a href="#2-solution-selection" class="hash-link" aria-label="Direct link to 2-solution-selection" title="Direct link to 2-solution-selection">​</a></h2>
<p>In order to solve the above problems, we are looking for components that can perform &quot;<strong>resource elasticity scaling</strong>&quot; and &quot;<strong>task management</strong>&quot;, and considering the trend of big data cloud-native, it is imminent to adopt cloud-native architecture, which can reduce the burden of big data operation and maintenance and provide better and more stable capabilities such as high availability, load balancing, grey update, etc. under Kubernetes architecture. The Kubernetes architecture reduces the burden on big data operations and provides better and more stable capabilities such as high availability, load balancing, and grey scale updates.</p>
<p>At the same time, simplifying the development and operation and maintenance of Apache Flink real-time tasks is also a problem that has to be faced. Since mid-2022, we have focused on researching Flink-related open-source and commercialisation-related projects, and in the process of technology selection, the company has conducted in-depth investigations mainly from several key dimensions, including:<strong>Kubernetes containerised deployment, lightweightness, multi-version support for Flink, and functionality. Flink version support, completeness of features, multiple deployment modes, support for CI/CD, stability, maturity, etc. And finally chose Apache StreamPark</strong>.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/cover-14b4d616ef68e17a584a773b097ea107.png" width="1080" height="496" class="img__KcZ"></p>
<p>In the process of using StreamPark, we have carried out in-depth application and exploration of it, and have successfully achieved 100+ Flink tasks easily deployed to Kubernetes, which can be very convenient for job management.</p>
<p>Next, will detail how we use StreamPark to achieve Flink on kubernetes in the production environment of the practice process, although the content is longer, but full of dry goods, the content is mainly divided into the following parts:</p>
<ul>
<li>
<p><strong>Environmental Preparation</strong>: This part introduces the installation and configuration process of Kubernetes, StreamPark, Maven, Docker, kubectl tools and Flink.</p>
</li>
<li>
<p><strong>StreamPark Use Chapter</strong>: This part introduces how to use StreamPark to start session clusters, as well as the process of deploying SQL and JAR jobs.</p>
</li>
<li>
<p><strong>Flink Tasks Application Scenarios</strong>: In this section, we will share the practical scenarios of Joyful Hub&#x27;s actual use of Flink tasks.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="3-practical---environment-preparation"><strong>3. Practical - Environment Preparation</strong><a href="#3-practical---environment-preparation" class="hash-link" aria-label="Direct link to 3-practical---environment-preparation" title="Direct link to 3-practical---environment-preparation">​</a></h2>
<p>Next we will start from the installation of a detailed introduction to the StreamPark landing practice, on the Tencent cloud products, some of the steps, will be briefly introduced at the end of the article, here mainly share the core steps.</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="31-preparing-the-kubernetes-environment"><strong>3.1. Preparing the Kubernetes Environment</strong><a href="#31-preparing-the-kubernetes-environment" class="hash-link" aria-label="Direct link to 31-preparing-the-kubernetes-environment" title="Direct link to 31-preparing-the-kubernetes-environment">​</a></h3>
<p>Joymaker&#x27;s Kubernetes environment uses the Tencent Cloud container service product, in which the Kubernetes namespace is mainly divided as follows:</p>
<ul>
<li>
<p><strong>Apache Doris</strong>: Doris cluster + 3 FE (standard nodes) + CN (1 supernode).</p>
</li>
<li>
<p><strong>Apache Flink</strong>: The Flink cluster consists of a supernode, which is the equivalent of an oversized resource machine that is very easy to use and can quickly and elastically scale to tens of thousands of pods.</p>
</li>
<li>
<p><strong>BigData</strong>: contains various Big Data components.</p>
</li>
</ul>
<p>In addition, we have two native nodes that are mainly used to deploy StreamPark, Dolphinscheduler, and Prometheus + Grafana. screenshots related to the cluster information are shown below:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/clusters-dd6a35ed22d17b2020d7301f273d3c2f.png" width="1080" height="580" class="img__KcZ"></p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="32-mounting-streampark"><strong>3.2. Mounting StreamPark</strong><a href="#32-mounting-streampark" class="hash-link" aria-label="Direct link to 32-mounting-streampark" title="Direct link to 32-mounting-streampark">​</a></h3>
<p>We are using the latest stable version of StreamPark 2.1.4, which fixes some bugs and adds some new features, such as support for Flink 1.18, Jar task support via pom or uploading dependencies and so on.</p>
<p>Although StreamPark supports Docker and Kubernetes deployment, for the sake of saving time and the need to containerise all big data components in a top-level design, we currently chose <strong>to quickly build StreamPark on a CVM in the cloud</strong>, and the following is the installation and deployment script for StreamPark:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Use root user to enter the installation directory (java environment is required first) and k8s environment on the same network segment!!!! You can save yourself the trouble.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cd /data </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Download the binary installer.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">wget https://dlcdn.apache.org/incubator/streampark/2.1.4/apache-streampark_2.12-2.1.4-incubating-bin.tar.gz   </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Compare it with the values provided to ensure the package is complete.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sha512sum apache-streampark_2.12-2.1.2-incubating-bin.tar.gz  #unzip it</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">tar -xzvf apache-streampark_2.12-2.1.2-incubating-bin.tar.gz  #rename it</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv apache-streampark_2.12-2.1.2-incubating-bin streampark_2.12-2.1.2 #create softlinks</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ln -s streampark_2.12-2.1.2  streampark</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Modify the database configuration</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">vim /data/streampark/conf/application-mysql.ymlspring:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  datasource:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    username: root</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    password: xxxxx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    url: jdbc:mysql://10.16.x.x:3306/streampark_k8s?...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Modify streampark kernel configuration You can modify the port (because k8s nodeport port range 30000-32767) so you can configure this range to save the port for external development and then configure or account password We use cos for storage so we do not configure hdfs.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">vim /data/streampark/conf/application.yml      workspace:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   local: /data/streampark/streampark_workspace #create the required directory</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mkdir -p  vim /data/streampark/conf/application.yml</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Initialise the database tables for streampark. Requires a mysql client in the environment. After execution, you can go to mysql and see if the tables exist.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mysql -u root -p xxxxx &lt; /data/streampark/script/schema/mysql-schema.sql</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Add the dependent mysql-connector package because it&#x27;s not under the streampark lib. Under /data/streampark/lib run.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">wget https://repo1.maven.org/maven2/com/mysql/mysql-connector-j/8.0.33/mysql-connector-j-8.0.33.jar </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Start and log in. You can verify the java environment first. java -version to make sure it&#x27;s ok. Execute under /data/streampark/lib.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> ./startup.sh </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="33-mounting-maven"><strong>3.3. Mounting Maven</strong><a href="#33-mounting-maven" class="hash-link" aria-label="Direct link to 33-mounting-maven" title="Direct link to 33-mounting-maven">​</a></h3>
<p>To configure Flink tasks on StreamPark, you can download the dependencies via maven, here is the Maven installation configuration:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Download maven as root user.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cd /data &amp;&amp; wget https://dlcdn.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Verify that the installation package is complete.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sha512sum apache-maven-3.9.6-bin.tar.gz </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Unzip Softlink.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">tar -xzvf apache-maven-3.9.6-bin.tar.gz </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ln -s apache-maven-3.9.6 maven</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Set up a maven mirror to speed up downloads from the AliCloud repository.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">vim /data/maven/conf/settings.xml</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;mirror&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   &lt;id&gt;alimaven&lt;/id&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;name&gt;aliyun maven&lt;/name&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;/mirror&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;mirror&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;id&gt;alimaven&lt;/id&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;name&gt;aliyun maven&lt;/name&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> &lt;/mirror&gt;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Environment Variables Finally add.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">export MAVEN_HOME=/data/maven</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">PATH=$MAVEN_HOME/bin:$PATH</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Validate.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">source /etc/profile  &amp;&amp; mvn -version</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="34-mounting-docker"><strong>3.4 Mounting Docker</strong><a href="#34-mounting-docker" class="hash-link" aria-label="Direct link to 34-mounting-docker" title="Direct link to 34-mounting-docker">​</a></h3>
<p>Because StreamPark uses Kubernetes, you can use Docker to build and upload images to your company&#x27;s popular Harbor image service, here&#x27;s the Docker install script</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Uninstall the old version If available</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sudo yum remove docker \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-client \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-client-latest \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-common \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-latest \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-latest-logrotate \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-logrotate \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         docker-engine</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Download the repository</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo      #AliCloud docker-ce image repository</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Update the package index </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">yum makecache     </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Download and install</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">yum install docker-ce docker-ce-cli containerd.io -y # docker-ce community edition ee enterprise edition</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Start View </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl start docker &amp;&amp; docker version</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Boot</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl enable docker</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="35-kubectl-tool-installation"><strong>3.5. Kubectl Tool Installation</strong><a href="#35-kubectl-tool-installation" class="hash-link" aria-label="Direct link to 35-kubectl-tool-installation" title="Direct link to 35-kubectl-tool-installation">​</a></h3>
<p>In order to interact with the Kubernetes cluster, view configurations, access logs, etc., we also installed the kubectl tool. Before installing kubectl, you first need to get the access credentials for the Kubernetes cluster from here, as shown in the following figure:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/access_credential-5672963a435919d770ca7eb6210a2375.png" width="1080" height="536" class="img__KcZ"></p>
<p>Next, download a copy of the configuration to the root user directory, specify the directory and rename it:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 1）Create the default hidden directory.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mkdir -p /root/.kube   </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 2）Upload k8s intranet access credentials.                 </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">rz cls-dtyxxxxl-config</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 3）Modify the default name of the credentials.               </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv cls-dtyxxxxl-config config  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 4）Place the credentials in the specified location.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv config /root/.kube </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can install the kubetcl client as follows (you can also install <strong>kubectx</strong> to make it easier to access multiple kubernetes clusters and switch between fixed namespaces):</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 1）Download the latest version.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">curl -LO &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 2）Add execute permissions.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chmod +x kubectl</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 3）Move to a common tool command location.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv ./kubectl /usr/local/bin/kubectl</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 4）This can be configured in /etc/profile or in .bashrc in the root user&#x27;s home directory.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">vim /root/.bashrc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">export JAVA_HOME=/usr/local/jdk1.8.0_391</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">PATH=/usr/local/bin:$JAVA_HOME/bin:$PATH</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 5）Verify the client and cluster keys.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">kubectl cluster-info</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, you also need to create a Flink-specific account credentials (which will be used later):</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 1）Create namespace.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">kubectl create namespace flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 2）Create account for flink to access k8s Remember to bring the namespace!</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">kubectl  create serviceaccount flink-service-account -n flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># 3）Bind some permissions for container operations to this account Remember with namespaces!!!</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">kubectl  create clusterrolebinding flink-role-binding-flink --clusterrole=edit --serviceaccount=flink:flink-service-account -n flink  </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="36-installation-configuration-flink"><strong>3.6. Installation Configuration Flink</strong><a href="#36-installation-configuration-flink" class="hash-link" aria-label="Direct link to 36-installation-configuration-flink" title="Direct link to 36-installation-configuration-flink">​</a></h3>
<p>We chose the Flink1.17-scala2.12 Java11 image for our Kubernetes environment because some of the dependencies of Flink 1.18 were not easy to find.</p>
<p>Download and extract the flink-1.17.2-bin-scala_2.12.tgz installer with the following script:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">cd /data &amp;&amp; wget https://dlcdn.apache.org/flink/flink-1.17.2/flink-1.17.2-bin-scala_2.12.tgz</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Integrity checksum.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sha512sum flink-1.17.2-bin-scala_2.12.tgz</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Unzip</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">tar -xzvf flink-1.17.2-bin-scala_2.12.tgz</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Rename</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv flink-1.17.2-bin-scala_2.12 flink-1.17.2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Soft connect.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ln -s flink-1.17.2 flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Store old binary packages.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mv flink-1.17.2-bin-scala_2.12.tgz /data/softbag   </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At this point, we have set up the environment, the following continue to step by step detailed explanation of the use of StreamPark.</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="4-practical---streampark-in-action"><strong>4. Practical - StreamPark in Action</strong><a href="#4-practical---streampark-in-action" class="hash-link" aria-label="Direct link to 4-practical---streampark-in-action" title="Direct link to 4-practical---streampark-in-action">​</a></h2>
<p>Readers who want to get a quick overview of StreamPark running jobs to Kubernetes can watch the video below:</p>
<p>// Video link (Flink On Kubernetes Application Hands-On Tutorial)</p>
<p>// Video link (Flink On Kubernetes Session Hands-On Tutorial)</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="41-configure-flink-home"><strong>4.1. Configure Flink Home</strong><a href="#41-configure-flink-home" class="hash-link" aria-label="Direct link to 41-configure-flink-home" title="Direct link to 41-configure-flink-home">​</a></h3>
<p>After logging in to StreamPark, switch to the Flink Home menu and configure the directory where we extracted the Flink installation package earlier, as shown in the screenshot below:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/flink_home-35bb262214d42ca4276c3e8152b1f20b.png" width="1080" height="386" class="img__KcZ"></p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="42-establish-flink-session"><strong>4.2. Establish Flink Session</strong><a href="#42-establish-flink-session" class="hash-link" aria-label="Direct link to 42-establish-flink-session" title="Direct link to 42-establish-flink-session">​</a></h3>
<p>Then switch to FlinkCluster and Add New to add a new Flink cluster:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/flink_cluster-7ee9edd1b1777a91e7c5225ecebf9550.png" width="1080" height="508" class="img__KcZ"></p>
<p>Configuration details are as follows, here is the first part of the configuration:</p>
<p><strong>Configuration details</strong>: cluster name and Kubernetes cluster ID We usually write the same, fill in the correct Kubernetes service account, here the image is used in tencent cloud tcr, and use lb as the external access to the Flink UI. (The slots here are usually set to 2, and the task parallelism is usually a multiple of 2, so that the session cluster has no idle resources).</p>
<p><img decoding="async" loading="lazy" src="/assets/images/first_configuration-d41d93c20abd21359a8b24a9b75b7ea4.png" width="933" height="564" class="img__KcZ"></p>
<p>The second part of the configuration content:</p>
<p><strong>Configuration details</strong>: We take the Session mode, a JobManager manages a lot of tasks, so the resources can be slightly larger, we give 2G, after observing can be satisfied, but due to the task is more, the memory allocation of JobManager metaspace consumption is relatively large, so you can be the default of 256M, change to 500M, after After observation, a session manages less than 10 tasks, this configuration is reasonable.</p>
<p>After TaskManager memory session configuration is given, it can not be modified in StreamPark programme configuration page, so you can estimate the amount of session project data, if the amount of data is large, you can adjust &quot;CPU : Memory&quot; to &quot;1 core : 2G&quot;, of course, you can also adjust &quot;CPU : Memory&quot; to &quot;1 core : 2G&quot;, of course, you can also change the default to 256M. 2G&quot;, of course, can also be larger, because the data processing and the number of TaskManager related, that is, the degree of parallelism, so you can basically avoid some OOM problems, we &quot;1 : 2&quot; session cluster project a day to deal with the data volume of six billion, 18 Parallelism is for reference only. The default cpu: memory 1 : 1 is basically ok.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/second_configuration-4dbfe7fdf6dc5297c9763e8847d95461.png" width="1080" height="468" class="img__KcZ"></p>
<p>The last part reads as follows:：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/third_configuration-f2cc57a25457ffab62730c1609ef3ec9.png" width="1080" height="486" class="img__KcZ"></p>
<p>The exact textual content is posted here:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Access method reuse lb+port lb can be created in advance without k8s creation so that the ip is fixed. It is more convenient to reuse.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drest.port=8091</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.rest-service.annotations=service.kubernetes.io/qcloud-share-existed-lb:true,service.kubernetes.io/tke-existed-lbid:lb-iv9ixxxxx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.rest-service.exposed.type=LoadBalancer</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#cp sp access tencent cloud cos using s3 protocol plugin way. </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dcontainerized.master.env.ENABLE_BUILT_IN_PLUGINS=flink-s3-fs-hadoop-1.17.2.jar</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dcontainerized.taskmanager.env.EANABLE_BUILT_IN_PLUGINS=flink-s3-fs-hadoop-1.17.2.jar</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.dir=s3://k8s-bigdata-xxxxxx/flink-checkpoints</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.savepoints.dir=s3://k8s-bigdata-xxxxx/flink-savepoints</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#The task scheduling policy in #k8s, the node selection policy, because the flink namespace is logical, and the node selection policy can be made to run on a flink-specific physical supernode.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.jobmanager.node-selector=usefor:flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.taskmanager.node-selector=usefor:flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Enable high availability for jobmanager Use k8s implementation, use cos directory storage, no hdfs overall.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dhigh-availability.type=kubernetes</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dhigh-availability.storageDir=s3://k8s-bigdata-xxx/flink-recovery</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.cluster-id=streampark-share-session</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.jobmanager.replicas=2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#pod image pull policy and flink cancel cp reservation Time zone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.container.image.pull-policy=Always</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.externalized-checkpoint-retention=RETAIN_ON_CANCELLATION</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dtable.local-time-zone=Asia/Shanghai</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#Mirror pull cache acceleration as explained below.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.taskmanager.annotations=eks.tke.cloud.tencent.com/use-image-cache: imc-6iubofdt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.jobmanager.annotations=eks.tke.cloud.tencent.com/use-image-cache: imc-6iubofdt  </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: Flink basic information can be configured in the conf file, and more general information is recommended to be written in the session, StreamPark is more appropriate to fill in the parallelism/cp/sp/fault-tolerance/main parameter, and so on.</p>
<p>Finally, you can start the session cluster. You can use the kubectl command to check whether the Flink kubernetes session cluster has started successfully:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/session_cluster-c4d11c15302e9cdbe70786b8ae6177c1.png" width="653" height="81" class="img__KcZ"></p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="43-task-configuration"><strong>4.3. Task Configuration</strong><a href="#43-task-configuration" class="hash-link" aria-label="Direct link to 43-task-configuration" title="Direct link to 43-task-configuration">​</a></h3>
<p>Here we will continue to demonstrate the use of StreamPark to submit three types of tasks, namely <strong>SQL tasks, Jar tasks, and Application mode tasks</strong>.</p>
<ul>
<li><strong>Submitting a Flink SQL job</strong></li>
</ul>
<p>A screenshot of the configuration of a Flink Sql job is shown below:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/sql_configuration-cf75e4e90e78db9a2e05a286fd8cf54c.png" width="1080" height="556" class="img__KcZ"></p>
<p>The kubernetes clusterid should just be the session name of the corresponding project:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/kubernetes_configuration-50a637b897415c1d26f17d1ebb0fd690.png" width="1080" height="532" class="img__KcZ"></p>
<p>The dynamic parameters are configured as follows:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.dir=s3://k8s-bigdata-12xxxxx/flink-checkpoints/ro-cn-sync</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.savepoints.dir=s3://k8s-bigdata-12xxxxxxx/flink-savepoints/ro-cn-sync</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.container.image.pull-policy=Always</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.service-account=flink-service-account</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.interval=25s</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.mode=EXACTLY_ONCE</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dtable.local-time-zone=Asia/Shanghai</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.fixed-delay.attempts=10</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.fixed-delay.delay=3min  </span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Submit Flink JAR Tasks</strong></li>
</ul>
<p>The Jar task is basically the same as the Sql task, the configuration screenshot is below:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/jar_configuration-fc88df4ae67c670f62de8eb0a51db10d.png" width="1080" height="552" class="img__KcZ"></p>
<p>Dynamic parameters are as follows (if there is a configuration template, here can be more streamlined, because StreamPark supports very good task replication, so you can write a standard Jar and SQL task demo, the rest of the tasks are replicated, which can greatly improve the efficiency of task development):</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.dir=s3://k8s-bigdata-1xxxx/flink-checkpoints/ro-cn-shushu</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.savepoints.dir=s3://k8s-bigdata-1xxxx/flink-savepoints/ro-cn-shushu</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.container.image.pull-policy=Always</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.service-account=flink-service-account</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.interval=60s</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.mode=EXACTLY_ONCE</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.num-retained=2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.type=failure-rate</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.failure-rate.delay=3min</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.failure-rate.failure-rate-interval=30min</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drestart-strategy.failure-rate.max-failures-per-interval=8</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Submitting a Flink Application task</strong></li>
</ul>
<p>Of course, you can also deploy Application mode tasks to Kubernetes, so here&#x27;s an example, starting with the first part of the configuration:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/application_first_configuration-354324b7b32b467a43dbc1d97ec40053.png" width="1012" height="395" class="img__KcZ"></p>
<p>This is the second part of the configuration as follows:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/application_second_configuration-29d9a7c1e9af25d1c07fdf5cb7e22eb4.png" width="1080" height="716" class="img__KcZ"></p>
<p>The third part of the configuration is as follows:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/application_third_configuration-c7983a9c4c7acfe53268d98a44b4237c.png" width="1080" height="386" class="img__KcZ"></p>
<p>Dynamic parameters:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/dynamic_parameter-2d1c54c8137ab01e9437f8b6fbbb13de.png" width="954" height="603" class="img__KcZ"></p>
<p>Detailed configuration content:：</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dcontainerized.master.env.ENABLE_BUILT_IN_PLUGINS=flink-s3-fs-hadoop-1.17.2.jar </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dcontainerized.taskmanager.env.ENABLE_BUILT_IN_PLUGINS=flink-s3-fs-hadoop-1.17.2.jar</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.dir=s3://k8s-bigdata-xxx/flink-checkpoints/Kafka2Rocketmq2Kafka</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.savepoints.dir=s3://k8s-bigdata-xxx/flink-savepoints/Kafka2Rocketmq2Kafka</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.container.image.pull-policy=Always</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.service-account=flink-service-account</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.interval=60s</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dexecution.checkpointing.mode=EXACTLY_ONCE</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dstate.checkpoints.num-retained=2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Drest.port=8092</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.jobmanager.node-selector=usefor:flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.taskmanager.node-selector=usefor:flink</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.rest-service.annotations=service.kubernetes.io/qcloud-share-existed-lb:true,service.kubernetes.io/tke-existed-lbid:lb-xxx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dkubernetes.rest-service.exposed.type=LoadBalancer</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">-Dfs.allowed-fallback-filesystems=s3</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="44-build-tasks"><strong>4.4. Build Tasks</strong><a href="#44-build-tasks" class="hash-link" aria-label="Direct link to 44-build-tasks" title="Direct link to 44-build-tasks">​</a></h3>
<p>The task is then constructed, and each step of the task construction can be clearly seen here:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/task_construction-1376844f54646571bf10a8dbfd729fac.png" width="437" height="902" class="img__KcZ"></p>
<p>Eventually you can run it and observe that the task is running:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/running-0e6a0f7e492c6d62638f8a255200e8be.png" width="581" height="235" class="img__KcZ"></p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="45-notification-alarm-configuration-optional"><strong>4.5. Notification Alarm Configuration (optional)</strong><a href="#45-notification-alarm-configuration-optional" class="hash-link" aria-label="Direct link to 45-notification-alarm-configuration-optional" title="Direct link to 45-notification-alarm-configuration-optional">​</a></h3>
<p>Of course, StreamPark supports multiple notification alert methods (e.g. mailboxes and flybooks, etc.), and we use the mailbox method, which can be configured directly from the interface:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/alarm_configuration-3fd492650cb0a7ec81104a9f4fdd8379.png" width="1080" height="622" class="img__KcZ"></p>
<p>So far, we have shared how to successfully go about deploying different types of Flink tasks running in kubernetes in StremPark, very silky smooth!</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="5-practical---homework-application-scenarios"><strong>5. Practical - Homework Application Scenarios</strong><a href="#5-practical---homework-application-scenarios" class="hash-link" aria-label="Direct link to 5-practical---homework-application-scenarios" title="Direct link to 5-practical---homework-application-scenarios">​</a></h2>
<p>Next, we will continue to dissect the job, from the tuning, hands-on and other scenarios to give us a better understanding of the application of Flink tasks.</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="51-tuning-recommendations"><strong>5.1. Tuning Recommendations</strong><a href="#51-tuning-recommendations" class="hash-link" aria-label="Direct link to 51-tuning-recommendations" title="Direct link to 51-tuning-recommendations">​</a></h3>
<p><strong>Recommendation 1 (time zone)</strong>: containers need to be in utc+8 to easily see the logs, we can add the following in the conf configuration:</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">env.java.opts.jobmanager: -Duser.timezone=GMT+08</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">env.java.opts.taskmanager: -Duser.timezone=GMT+08</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Recommendation 2 (StreamPark Variable Management)</strong>: StreamPark provides variable management, which allows us to manage some configurations to improve security and convenience:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/variable_management-1213e43f16736c78f9f8b1c85c537926.png" width="1071" height="197" class="img__KcZ"></p>
<p><strong>Proposal 3 (StreamPark Passing Parameters)</strong>: On YARN, we used Flink&#x27;s own toolkit to pass parameters, and it was difficult to pass parameters to the Flink environment, so we didn&#x27;t look into it. We chose to pass in the program parameters through StreamPark, so that it can be used in both YARN and kubernetes, <strong>while the application and session methods in kubernetes can also be used, it becomes more general and easy to change, highly recommended</strong>!</p>
<p><img decoding="async" loading="lazy" src="/assets/images/incoming_parameter-4fbd6146a85b569ddae19dd005922038.png" width="670" height="290" class="img__KcZ"></p>
<p><strong>Recommendation 4 (Use Session pattern)</strong>: Although the Yarn-application pattern provides a high degree of task isolation, each of its tasks requires a separate jobmanager resource, which leads to excessive resource consumption. In addition, merging tasks, while reducing resource consumption, can lead to problems such as high workload and unstable data. In contrast, the session pattern allows tasks to share a single jobmanager resource in a session, which can maximise the saving of computing resources, and although it may have a single-point problem, it can be solved by using two jobmanager instances to achieve high availability. More importantly, the session mode also makes it easier to view logs generated due to job failures, which helps improve the efficiency of troubleshooting. Therefore, given its advantages in terms of resource utilisation, high availability and task failure handling, choosing session mode becomes a more desirable option.</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="52-data-cdc-synchronisation"><strong>5.2. Data CDC synchronisation</strong><a href="#52-data-cdc-synchronisation" class="hash-link" aria-label="Direct link to 52-data-cdc-synchronisation" title="Direct link to 52-data-cdc-synchronisation">​</a></h3>
<p><strong>[MySQL → Doris]</strong>: The following code essentially demonstrates the Flink sql pipeline for <strong>MySQL data synchronisation to Apache Doris</strong>:</p>
<div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-sql codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">login_log_mysql</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> login_log_id      </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">not</span><span class="token plain"> </span><span class="token boolean">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> account_id        </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> long_account_id   string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> short_account_id  string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> game_code         string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> package_code      string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> channel_id        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> login_at          </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> login_ip          string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_ua         string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_id         string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_net        string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_ratio      string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_os         string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_carrier    string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> ext               string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> created_at        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> updated_at        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> deleted_at        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">login_log_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;mysql-cdc&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;hostname&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;10.xxx.xxx.xxx&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3306&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;http_readxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;password&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xxxx@)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;database-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;player_user_center&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">-- &#x27;scan.startup.mode&#x27; = &#x27;latest-offset&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;earliest-offset&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;login_log_202[3-9][0-9]{2}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;server-time-zone&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;+07:00&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> login_log_doris</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(86, 156, 214)">date</span><span class="token plain">       </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   login_log_id    </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   account_id      </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   long_account_id     string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   short_account_id    string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   game_code       string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">package_code</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">   string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   login_at        string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   login_ip        string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_ua       string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_id       string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_net      string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_ratio    string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_os       string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   device_carrier  string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   ext             string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   created_at      string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   updated_at      string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   deleted_at      string     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">login_log_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;doris&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;jdbc-url&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;jdbc:mysql://xxx.xx.xx.xx:9030,xxx.xxx.xxx.xxx:9030,xxx.xxx.xxx.xxx:9030&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;load-url&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xxx.xx.xx.xx:8030;xxx.xx.xx.xx:8030;xxx.xx.xx.xx:8030&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;database-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_player_user_center&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ods_login_log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;password&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root123&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.semantic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;exactly-once&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.max-retries&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;10&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">view</span><span class="token plain"> login_log_flink_trans </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">login_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> login_log_id     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> account_id       </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> long_account_id  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> short_account_id </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> game_code        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> package_code     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> channel_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">login_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> login_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> login_ip         </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_ua        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_id        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_net       </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_ratio     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_os        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> device_carrier   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> ext              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">deleted_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> deleted_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> login_log_mysql</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">into</span><span class="token plain"> login_log_doris </span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> login_log_flink_trans</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_mysql</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> account_id        </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> open_id           string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> dy_openid         string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> dy_ios_openid     string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> ext               string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> last_channel      </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> last_login_time   </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> last_login_ip     string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> created_at        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> updated_at        </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> deleted_at        string </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;mysql-cdc&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;hostname&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xxx.xx.xx.xx&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3306&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;http_readxxxx&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;password&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xxxxx@)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;database-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;player_user_center&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">-- &#x27;scan.startup.mode&#x27; = &#x27;latest-offset&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;earliest-offset&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;account_[0-9]+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;server-time-zone&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;+07:00&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> account_doris</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">date</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   account_id       </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   open_id          string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   dy_openid        string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   dy_ios_openid    string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   ext              string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">last_channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   last_login_time  string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   last_login_ip    string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   created_at       string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   updated_at       string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   deleted_at       string   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;doris&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;jdbc-url&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;jdbc:mysql://xxx.xx.xx.xx:9030,xxx.xx.xx.xx:9030,xxx.xx.xx.xx:9030&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;load-url&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xxx.xx.xx.xx:8030;xxx.xx.xx.xx:8030;xxx.xx.xx.xx:8030&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;database-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_player_user_center&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ods_account_log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;password&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root123&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.semantic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;exactly-once&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.max-retries&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;10&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">view</span><span class="token plain"> account_flink_trans </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> account_id       </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> open_id          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> dy_openid        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> dy_ios_openid    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> ext              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> last_channel     </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">last_login_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> last_login_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> last_login_ip    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_timestamp_ltz</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> deleted_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> account_mysql</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">into</span><span class="token plain"> account_doris </span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> account_flink_trans</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>[Game Data Synchronisation]</strong>: pull kafka data collected by overseas <strong>filebeat to domestic kafka</strong> and process metadata processing:</p>
<div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-sql codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">--Create a kafka source table for hmt.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> kafka_in </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game environment hdf  /qc/cbt/obt/prod&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">host</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game server where logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">tags</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Log Tags normal | fix&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">  STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;File and offset of the log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">topic</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING METADATA VIRTUAL </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka topic&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">partition_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BIGINT</span><span class="token plain"> METADATA </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;partition&#x27;</span><span class="token plain"> VIRTUAL </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The kafka partition where the logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">offset</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BIGINT</span><span class="token plain"> METADATA VIRTUAL </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The offset of the kafka partition&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">  STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;uuid generated by filebeat&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">message</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tlog message&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">@timestamp</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;filebeat capture time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> METADATA </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;timestamp&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka storage message time&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_tlog&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sea-kafka-01:9092,sea-kafka-02:9092,sea-kafka-03:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.group.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;streamx-ro-sea-total&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.client.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;streamx-ro-sea-total&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.session.timeout.ms&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;60000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.request.timeout.ms&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;60000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;group-offsets&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">--&#x27;scan.startup.mode&#x27; = &#x27;earliest-offset&#x27;,\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.fetch.max.bytes&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;123886080&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.max.partition.fetch.bytes&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;50388608&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.fetch.max.wait.ms&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.max.poll.records&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json.ignore-parse-errors&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;false&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">--Creating the kafka official table for emr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> kafka_out_sea </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game environment qc/cbt/obt/prod&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">hostname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game server where logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">tags</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Log Tags normal | fix&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log_offset</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">  STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;File and offset of the log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">  STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;uuid generated by filebeat&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">topic</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka topic&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">partition_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The kafka partition where the logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">kafka_offset</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The offset of the kafka partition&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> eventname string </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;event name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">message</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tlog message&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">filebeat_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;filebeat collection time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">kafka_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka stored message time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;flink processed message time&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_tlog&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">--&#x27;properties.client.id&#x27; = &#x27;flinkx-ro-sea-prod-v2&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;emr_kafka1:9092,emr_kafka2:9092,emr_kafka3:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">--&#x27;sink.partitioner&#x27;= &#x27;fixed&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.delivery-guarantee&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;exactly-once&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.transactional-id-prefix&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_kafka_sync_v10&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.compression.type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;zstd&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.transaction.timeout.ms&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;600000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.message.max.bytes&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;13000000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.max.request.size&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;13048576&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">--&#x27;properties.buffer.memory&#x27; = &#x27;83554432&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.acks&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;-1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">--etl create target view</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">view</span><span class="token plain"> kafka_sea_in_view  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">host</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">tags</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> log_offset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">topic</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">partition_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">offset</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> kafka_offset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">     lower</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> eventname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">message</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">     CONVERT_TZ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">REPLACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">REPLACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">@timestamp</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;T&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;UTC&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Asia/Bangkok&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> filebeat_ts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> kafka_ts </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> flink_ts</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> kafka_in</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">--Write data to emr sea topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">into</span><span class="token plain"> kafka_out_sea</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> kafka_sea_in_view </span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>[Real-time counting warehouse]</strong>: shunt Jar program and ods -&gt; dwd sql processing function, part of the code screenshot below:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/jar-bf657c3fbc9aebd6022efea71b10c160.png" width="918" height="660" class="img__KcZ"></p>
<p>and the associated Flink sql:</p>
<div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-sql codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">--2 dwd_moneyflow_log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> kafka_in_money </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING   </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game environment qc/cbt/obt/prod&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">hostname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game server where logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Log unique id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">message</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tlog message&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">filebeat_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;filebeat collection time&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea_tlog_split_moneyflow&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;emr_kafka1:9092,emr_kafka2:9092,emr_kafka3:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.group.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;flinksql_kafka_in_moneyflow_v2&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;group-offsets&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">--&#x27;scan.startup.mode&#x27; = &#x27;earliest-offset&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.isolation.level&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;read_committed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json.ignore-parse-errors&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;false&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> kafka_out_money</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(212, 212, 212)">not</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;date&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vroleid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;role id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">moneytype</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Currency type&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game environment hdf  /qc/cbt/obt/prod&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">hostname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The game server where the logs are located&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">  string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The uuid generated by the filebeat capture&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">filebeat_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;filebeat capture time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   flink_ts string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;message time written by flink&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">gamesvrid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain">  </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Logged in game server number&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">dteventtime</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The time of the game event, format YYYY-MM-DD HH:MM:SS&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vgameappid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Game APPID&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">platid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ios 0 /android 1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">izoneareaid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;The zone id is used to uniquely identify a zone for split-server games; 0 for non-split-server games&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vopenid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> string </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;User&#x27;</span><span class="token plain">s OPENID number</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `vrolename` string NULL COMMENT &#x27;</span><span class="token keyword" style="color:rgb(86, 156, 214)">Character</span><span class="token plain"> name</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `jobid` int  NULL  COMMENT &#x27;</span><span class="token plain">Role Occupation </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">Wizard </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `gender` int NULL  COMMENT &#x27;</span><span class="token keyword" style="color:rgb(86, 156, 214)">Character</span><span class="token plain"> Gender </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">Male </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">Female</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `ilevel` int NULL  COMMENT &#x27;</span><span class="token keyword" style="color:rgb(86, 156, 214)">Character</span><span class="token plain"> base </span><span class="token keyword" style="color:rgb(86, 156, 214)">level</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `ijoblevel` int NULL  COMMENT &#x27;</span><span class="token keyword" style="color:rgb(86, 156, 214)">Character</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;s career level&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">playerfriendsnum</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Number of player friends&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">chargegold</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Character&#x27;</span><span class="token plain">s recharge experience </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cumulative recharge</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">iviplevel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Character&#x27;</span><span class="token plain">s VIP </span><span class="token keyword" style="color:rgb(86, 156, 214)">level</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `createtime` string NULL  COMMENT  &#x27;</span><span class="token plain">Account creation </span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `irolece` int NULL  COMMENT &#x27;</span><span class="token plain">Battle power</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">rating</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `unionid` int NULL  COMMENT &#x27;</span><span class="token plain">Guild ID</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `unionname`  string NULL COMMENT &#x27;</span><span class="token plain">Guild name</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `regchannel` int NULL  COMMENT &#x27;</span><span class="token plain">registration channel</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `loginchannel` int NULL  COMMENT &#x27;</span><span class="token plain">login channel</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `sequence` int NULL  COMMENT &#x27;</span><span class="token plain">Used </span><span class="token keyword" style="color:rgb(86, 156, 214)">to</span><span class="token plain"> correlate a single </span><span class="token keyword" style="color:rgb(86, 156, 214)">action</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">to</span><span class="token plain"> generate multiple logs </span><span class="token keyword" style="color:rgb(86, 156, 214)">of</span><span class="token plain"> different </span><span class="token keyword" style="color:rgb(86, 156, 214)">types</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">of</span><span class="token plain"> currency movement</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `reason` int NULL  COMMENT &#x27;</span><span class="token plain">Behavior </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currency flow </span><span class="token keyword" style="color:rgb(86, 156, 214)">level</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> reason</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `subreason` int NULL  COMMENT &#x27;</span><span class="token plain">Flow direction </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">item flow definition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `imoney` int NULL  COMMENT &#x27;</span><span class="token plain">Number </span><span class="token keyword" style="color:rgb(86, 156, 214)">of</span><span class="token plain"> currency changes</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `aftermoney` int NULL  COMMENT &#x27;</span><span class="token plain">Number </span><span class="token keyword" style="color:rgb(86, 156, 214)">of</span><span class="token plain"> aftermoney </span><span class="token keyword" style="color:rgb(86, 156, 214)">after</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">action</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `afterboundmoney` int NULL  COMMENT &#x27;</span><span class="token plain">Number </span><span class="token keyword" style="color:rgb(86, 156, 214)">of</span><span class="token plain"> money bound </span><span class="token keyword" style="color:rgb(86, 156, 214)">after</span><span class="token plain"> the </span><span class="token keyword" style="color:rgb(86, 156, 214)">action</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `addorreduce` int NULL  COMMENT &#x27;</span><span class="token plain">Increase </span><span class="token operator" style="color:rgb(212, 212, 212)">or</span><span class="token plain"> decrease: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">is</span><span class="token plain"> increase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">is</span><span class="token plain"> decrease</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `serialnum` string NULL COMMENT  &#x27;</span><span class="token plain">The running number</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `sourceid` int NULL  COMMENT &#x27;</span><span class="token plain">Channel number</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `cmd` string NULL COMMENT  &#x27;</span><span class="token plain">command word</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `orderid` string NULL COMMENT  &#x27;</span><span class="token keyword" style="color:rgb(86, 156, 214)">Order</span><span class="token plain"> id </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">contains</span><span class="token plain"> meowgoincrease </span><span class="token operator" style="color:rgb(212, 212, 212)">and</span><span class="token plain"> meowgoincrease</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> also </span><span class="token keyword" style="color:rgb(86, 156, 214)">contains</span><span class="token plain"> cash recharge </span><span class="token keyword" style="color:rgb(86, 156, 214)">order</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `imoneytype` int NULL  COMMENT &#x27;</span><span class="token plain">Currency </span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `distincid` string NULL COMMENT  &#x27;</span><span class="token plain">Visitor ID</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `deviceuid` string NULL COMMENT  &#x27;</span><span class="token plain">device ID</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `guildjob` int NULL  COMMENT &#x27;</span><span class="token plain">Guild Position</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;, </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">  `regtime` string NULL  COMMENT  &#x27;</span><span class="token plain">Account registration </span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">) WITH (</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">   &#x27;</span><span class="token plain">connector</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; = &#x27;</span><span class="token plain">doris</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    &#x27;</span><span class="token plain">jdbc</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">url</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;=&#x27;</span><span class="token plain">jdbc:mysql:</span><span class="token comment" style="color:rgb(106, 153, 85)">//xxx:9030,xxx:9030,xxx:9030&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;load-url&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;xx:8030;xxx:8030;xxx:8030&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;database-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ro_sea&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table-name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dwd_moneyflow_log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;password&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;root123&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sink.semantic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;exactly-once&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">view</span><span class="token plain"> kafka_out_money_view1  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_DATE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">interval</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">day</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_DATE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">hostname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> gamesvrid               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> dteventtime             </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> vgameappid              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> platid                  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> izoneareaid             </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> vopenid                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> vroleid                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> vrolename               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> jobid                   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> gender                  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> ilevel                  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">12</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> ijoblevel               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> playerfriendsnum        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> chargegold              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> iviplevel               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> createtime              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> irolece                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">18</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> unionid                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">19</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> unionname               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> regchannel              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> loginchannel            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">22</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">sequence</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">reason</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">24</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> subreason               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> moneytype               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> imoney                  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">27</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> aftermoney              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">28</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> afterboundmoney         </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">29</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> addorreduce             </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">30</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> serialnum               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> sourceid                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">cmd</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">33</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> orderid                 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">34</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> imoneytype              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">35</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> distincid               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">36</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> deviceuid               </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        try_cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">37</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> guildjob                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                                  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        SPLIT_INDEX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;|&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">38</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> regtime </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      filebeat_ts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_TIMESTAMP</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> flink_ts</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> kafka_in_money</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">into</span><span class="token plain"> kafka_out_money</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vroleid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">moneytype</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">env</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">hostname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">uuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">filebeat_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> flink_ts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">gamesvrid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">dteventtime</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vgameappid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">platid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">izoneareaid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vopenid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">vrolename</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">jobid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">gender</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ilevel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ijoblevel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">playerfriendsnum</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">chargegold</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">iviplevel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">createtime</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">irolece</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">unionid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">unionname</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">regchannel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">loginchannel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">sequence</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">reason</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">subreason</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">imoney</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">aftermoney</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">afterboundmoney</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">addorreduce</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">serialnum</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">sourceid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">cmd</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">orderid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">imoneytype</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">distincid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">deviceuid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">guildjob</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">regtime</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> kafka_out_money_view1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>[Advertisement system]: Use Flink SQL to slice and dice a row of log data to parse out the data in each field and complete the business calculations :</strong></p>
<div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-sql codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> ods_adjust_in </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  log STRING</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ad_adjust_callback&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;emr_kafka1:9092,emr_kafka2:9092,emr_kafka3:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.group.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ods_adjust_etl_20231011&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.max.partition.fetch.bytes&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4048576&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;group-offsets&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.isolation.level&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;read_committed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;raw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> ods_af_in </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  log STRING</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ad_af_callback&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;emr_kafka1:9092,emr_kafka2:9092,emr_kafka3:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.max.partition.fetch.bytes&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4048576&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.group.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ods_af_etl_20231011&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.startup.mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;group-offsets&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.isolation.level&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;read_committed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;raw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> ods_mmp_out </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DATE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_type</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">app_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">distinct_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">open_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">os_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">-- platform</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">country_code</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">install_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">bundle_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">media</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Message time processed by flink&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">device_properties</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> STRING</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kafka&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;topic&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ods_mmp_log&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;emr_kafka1:9092,emr_kafka2:9092,emr_kafka3:9092&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;scan.topic-partition-discovery.interval&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;60000&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;properties.group.id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;mmp2etl-out&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;format&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;json&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> ods_mmp_out</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Adjust&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_type</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">app_token</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">app_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">distinct_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">open_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">os_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">country_code</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">install_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">bundle_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">media</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">network</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">REGEXP_EXTRACT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;([\\(=])([a-z0-9]+)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">REGEXP_EXTRACT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;([\\(=])([a-z0-9]+)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">creative</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">REGEXP_EXTRACT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">creative</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;([\\(=])([a-z0-9]+)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">device_properties</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">     to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">FROM_UNIXTIME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.created_at&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.app_token&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">app_token</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.adid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adid</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">REPLACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"> TRIM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COALESCE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.event_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.activity_kind&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;_&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">TO_TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">FROM_UNIXTIME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.created_at&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">TO_TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">FROM_UNIXTIME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.installed_at&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">bigint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">install_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.network_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Unattributed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">THEN</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COALESCE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_publisher_platform&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;facebook&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ELSE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.network_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">END</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">network</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.network_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Unattributed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">THEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_campaign_group_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_campaign_group_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ELSE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.campaign_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">END</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.network_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Unattributed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">THEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_campaign_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_campaign_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ELSE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.adgroup_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">END</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.network_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Unattributed&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">THEN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_adgroup_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.fb_install_referrer_adgroup_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ELSE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.creative_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">END</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">creative</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.os_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">os_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.country_code&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">country_code</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.publisher_parameters&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ta_distinct_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">distinct_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.publisher_parameters&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.open_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">open_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.publisher_parameters&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ta_account_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_OBJECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ip&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ip&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ua&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ua&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;idfa&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.idfa&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;idfv&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.idfv&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;gps_adid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.gps_adid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;android_id&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.android_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;mac_md5&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.mac_md5&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;oaid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.oaid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;gclid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.gclid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;gbraid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.gbraid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dcp_wbraid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.dcp_wbraid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">device_properties</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> ods_adjust_in </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">COALESCE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.activity_kind&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.event_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">not</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;impression&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;click&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ALL</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  to_date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONVERT_TZ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.event_time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;UTC&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Asia/Shanghai&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">date</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;AppsFlyer&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_type</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.app_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">app_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">REPLACE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"> TRIM</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.event_name&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;-&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">TO_TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONVERT_TZ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.event_time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;UTC&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Asia/Shanghai&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">event_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.appsflyer_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">mmp_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.custom_data&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ta_distinct_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">distinct_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.custom_data&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.open_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">open_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.custom_data&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ta_account_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">account_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.platform&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">os_name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.country_code&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">country_code</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">TO_TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CONVERT_TZ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.install_time&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;UTC&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Asia/Shanghai&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">install_time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.bundle_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">bundle_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.media_source&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">media</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_channel&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.campaign&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; (&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_c_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_c_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">campaign_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_adset&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; (&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_adset_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_adset_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">adgroup_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_ad&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; (&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_ad_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">LOWER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.af_ad_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">ad_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">flink_ts</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">JSON_OBJECT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">     </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ip&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.ip&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ua&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.user_agent&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;idfa&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.idfa&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;idfv&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.idfv&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;gps_adid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.advertising_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;android_id&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.android_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;oaid&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUE</span><span class="token plain"> JSON_VALUE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$.oaid&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">device_properties</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">log</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> ods_af_in</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Data reporting</strong>: similar to Shenzhe</p>
<p><img decoding="async" loading="lazy" src="/assets/images/data_reporting-92cd1a36c4317a3bf33835a6df917c6d.png" width="976" height="325" class="img__KcZ"></p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="6--practical---tencent-cloud-environment"><strong>6.  Practical - Tencent Cloud Environment</strong><a href="#6--practical---tencent-cloud-environment" class="hash-link" aria-label="Direct link to 6--practical---tencent-cloud-environment" title="Direct link to 6--practical---tencent-cloud-environment">​</a></h2>
<p>The Flink task in this article is running in Tencent&#x27;s kubernetes environment, which includes some related knowledge points that will not be detailed here, for example:</p>
<ul>
<li>
<p><strong>Mirror synchronisation</strong>: harbor configures automatic synchronisation of mirrors to the Tencent cloud mirror service TCR.</p>
</li>
<li>
<p><strong>Mirror configuration</strong>: such as secret-free pull, cache acceleration.</p>
</li>
<li>
<p><strong>Flink webui extranet access</strong>: need to buy from the extranet lb in order to access Flink UI.</p>
</li>
<li>
<p><strong>Environmental access</strong>: because the kubernetes cluster is mainly a closed intranet computing environment, with the system network, security groups, permissions, routing, etc. need to be well configured and tested, in order to let the task really run in the production environment better.</p>
</li>
<li>
<p><strong>Security Group Configuration</strong>: In order to pull real-time data from overseas games and write it to the domestic Kafka cluster to ensure a smooth data flow, we use a dedicated line and open a dedicated extranet access to the kubernetes Flink super node to achieve this.</p>
</li>
</ul>
<p>Relevant screenshots:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/cloud_environment-b4dd173f9edbb32b1af136e9474bf494.png" width="1080" height="315" class="img__KcZ"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/instance_management-90be7742bb44cdf79195444a45a79126.png" width="1080" height="490" class="img__KcZ"></p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="7--benefits-and-expectations"><strong>7.  Benefits and expectations</strong><a href="#7--benefits-and-expectations" class="hash-link" aria-label="Direct link to 7--benefits-and-expectations" title="Direct link to 7--benefits-and-expectations">​</a></h2>
<p><strong>After using Apache StreamPark, the biggest impression we got is that StreamPark is very easy to use. With simple configuration, we can quickly deploy Flink tasks to any cluster and monitor and manage thousands of jobs in real time, which is very nice!</strong></p>
<ul>
<li>
<p>The benefits are as follows: A large number of real-time tasks were quickly migrated to Kubernetes via StreamPark. After YARN was dropped, the Apache Doris cluster, which had been a part of the early mix, became very stable after there was no resource contention.</p>
</li>
<li>
<p>When replenishing data, we can quickly borrow the capacity of super nodes in TKE, and through the StreamPark platform, it is easy to populate and shrink thousands of pods in a minute, which makes replenishment very efficient.</p>
</li>
<li>
<p>The technology stack has become more advanced and unified. The pile of components in the era of big data has become more and more efficient and unified. At present, Joy Big Data has already completed the Kubernetes cloud nativeisation of a series of components such as Doris, Flink, Spark, Hive, Grafana, Prometheus, etc., which makes operation and maintenance simpler and more efficient, and StreamPark has played a great role in the Flink containerisation process.</p>
</li>
<li>
<p>StreamPark platform is easy to operate, complete, stable and responsive to the community, which really makes stream processing job development more and more simple, and brings us a lot of convenience, allowing us to focus more on business, kudos~.</p>
</li>
</ul>
<p>Here, we also expect StreamPark can do better and better, here are some optimisation suggestions:</p>
<ul>
<li>
<p><strong>Support Operator Deployment</strong>: Expect Flink on kubernetes to support operator deployment method because of its benefits of customising resource types, specifying invocation order, monitoring metrics and so on.</p>
</li>
<li>
<p><strong>Support autoscaler</strong>: Because real-time streaming tasks have business peaks and valleys, special weekly events, doubled data volume, and artificial periodic adjustment of parallelism is not very suitable. Therefore, in combination with Kubernetes, we expect StreamPark to complete the operator way to create a Flink cluster as soon as possible. In Flink 1.17 or above, you can set a better threshold, use the automatic pop-up shrinkage to achieve the peak period to pop up more resources to process the data, and in the trough period to shrink the resources to save the cost, and we are very much looking forward to it.</p>
</li>
<li>
<p><strong>programme error logic</strong>: the current Flink task set a fixed number of times or ratio retry, but the current StreamPark mail alarms are particularly frequent, not the expected task fails once for an alarm, so I hope that it will be further upgraded.</p>
</li>
</ul>
<p>Finally, we would like to thank the <strong>Apache StreamPark</strong> community for their selfless help in using StreamPark. Their professionalism and user-centred attitude has enabled us to use this powerful framework more efficiently and smoothly. We look forward to StreamPark getting better and better, and becoming a model for up-and-coming Apache projects!</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_Wr5y"><div class="post-footer"><div class="col"><b>Tags:</b><ul class="tags_bUDc padding--none margin-left--sm"><li class="tag_edSN"><a class="tag_mtSO tagRegular_u5wg" href="/blog/tags/stream-park">StreamPark</a></li><li class="tag_edSN"><a class="tag_mtSO tagRegular_u5wg" href="/blog/tags/production-practice">Production Practice</a></li></ul></div><div class="col col-3 text--right"><a href="https://github.com/apache/incubator-streampark-website/edit/dev/blog/12-streampark-usercase-joymaker.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_WHnd" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></footer></article></div></div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev paginationNavLink_UdUv" href="/blog/streampark-usercase-tianyancha"><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.2751 19.175L10.3251 18.125L5.4501 13.25H21.6001V11.75H5.4501L10.3251 6.87501L9.2751 5.82501L2.5751 12.5L9.2751 19.175Z" fill="currentColor"></path></svg><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">Newer Post</div><div class="paginationNavLabel_YPzM pagination-nav__label">Apache StreamPark™ helps Tianyancha real-time platform construction｜Multiple-fold increase in efficiency</div></div></a><a class="pagination-nav__link pagination-nav__link--next paginationNavLink_UdUv" href="/blog/streampark-usercase-chinaunion"><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">Older Post</div><div class="paginationNavLabel_YPzM pagination-nav__label">China Union&#x27;s Flink Real-Time Computing Platform Ops Practice</div></div><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7249 19.175L13.6749 18.125L18.5499 13.25H2.3999V11.75H18.5499L13.6749 6.87501L14.7249 5.82501L21.4249 12.5L14.7249 19.175Z" fill="currentColor"></path></svg></a></nav></main><div class="col col--2"><div class="tableOfContents_jeP5 thin-scrollbar" style="opacity:0;transform:translateX(100px) translateZ(0)"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-operational-context-and-challenges" class="table-of-contents__link toc-highlight"><strong>1. Operational Context and Challenges</strong></a></li><li><a href="#2-solution-selection" class="table-of-contents__link toc-highlight"><strong>2. Solution Selection</strong></a></li><li><a href="#3-practical---environment-preparation" class="table-of-contents__link toc-highlight"><strong>3. Practical - Environment Preparation</strong></a><ul><li><a href="#31-preparing-the-kubernetes-environment" class="table-of-contents__link toc-highlight"><strong>3.1. Preparing the Kubernetes Environment</strong></a></li><li><a href="#32-mounting-streampark" class="table-of-contents__link toc-highlight"><strong>3.2. Mounting StreamPark</strong></a></li><li><a href="#33-mounting-maven" class="table-of-contents__link toc-highlight"><strong>3.3. Mounting Maven</strong></a></li><li><a href="#34-mounting-docker" class="table-of-contents__link toc-highlight"><strong>3.4 Mounting Docker</strong></a></li><li><a href="#35-kubectl-tool-installation" class="table-of-contents__link toc-highlight"><strong>3.5. Kubectl Tool Installation</strong></a></li><li><a href="#36-installation-configuration-flink" class="table-of-contents__link toc-highlight"><strong>3.6. Installation Configuration Flink</strong></a></li></ul></li><li><a href="#4-practical---streampark-in-action" class="table-of-contents__link toc-highlight"><strong>4. Practical - StreamPark in Action</strong></a><ul><li><a href="#41-configure-flink-home" class="table-of-contents__link toc-highlight"><strong>4.1. Configure Flink Home</strong></a></li><li><a href="#42-establish-flink-session" class="table-of-contents__link toc-highlight"><strong>4.2. Establish Flink Session</strong></a></li><li><a href="#43-task-configuration" class="table-of-contents__link toc-highlight"><strong>4.3. Task Configuration</strong></a></li><li><a href="#44-build-tasks" class="table-of-contents__link toc-highlight"><strong>4.4. Build Tasks</strong></a></li><li><a href="#45-notification-alarm-configuration-optional" class="table-of-contents__link toc-highlight"><strong>4.5. Notification Alarm Configuration (optional)</strong></a></li></ul></li><li><a href="#5-practical---homework-application-scenarios" class="table-of-contents__link toc-highlight"><strong>5. Practical - Homework Application Scenarios</strong></a><ul><li><a href="#51-tuning-recommendations" class="table-of-contents__link toc-highlight"><strong>5.1. Tuning Recommendations</strong></a></li><li><a href="#52-data-cdc-synchronisation" class="table-of-contents__link toc-highlight"><strong>5.2. Data CDC synchronisation</strong></a></li></ul></li><li><a href="#6--practical---tencent-cloud-environment" class="table-of-contents__link toc-highlight"><strong>6.  Practical - Tencent Cloud Environment</strong></a></li><li><a href="#7--benefits-and-expectations" class="table-of-contents__link toc-highlight"><strong>7.  Benefits and expectations</strong></a></li></ul></div></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Join Community</div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="subscribe-box btns">
                  <a class="btn btn-primary" href="https://github.com/apache/incubator-streampark"><i class="fa fa-github"></i><span>Github</span></a>
                  <a class="btn btn-primary" href="https://github.com/apache/incubator-streampark/issues"><i class="fa fa-slack"></i><span>Issue Tracking</span></a>
                  <a class="btn btn-primary" href="javascript:void(0)">
                    <i class="fa fa-wechat"></i>
                    <span>Wechat</span>
                    <div class="wechat-dropdown"><img src="/image/join_wechat.png" alt="weChat"></div>
                  </a>
                </div>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>
        <div>
          <div style="margin-bottom: 30px;">
            <a href="https://incubator.apache.org/" class="footerLogoLink" one-link-mark="yes">
              <img alt="Apache Incubator logo" class="footer__logo" width="200">
            </a>
          </div>
          <div>
            <p>
            Apache StreamPark is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </p>
          </div>
        </div>

        <div>
          <span>
            Copyright © 2022-2024 The Apache Software Foundation. Apache StreamPark, StreamPark, and its feather logo are trademarks of The Apache Software Foundation.
          </span>
        </div>
      </div></div></div></div></footer></div>
</body>
</html>