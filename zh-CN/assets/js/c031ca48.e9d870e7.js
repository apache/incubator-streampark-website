"use strict";(self.webpackChunkapache_streampark_website=self.webpackChunkapache_streampark_website||[]).push([[7526],{80810:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>l,default:()=>k,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var r=n(86070),t=n(76113),i=n(60630),c=n(24990);const s={id:"kafka",title:"Apache Kafka Connector",sidebar_position:1},l=void 0,o={id:"framework/connector/kafka",title:"Apache Kafka Connector",description:"Apache Flink\xae \u5b98\u65b9\u63d0\u4f9b\u4e86 Apache Kafka \u7684\u8fde\u63a5\u5668\uff0c\u7528\u4e8e\u4ece Kafka \u4e3b\u9898\u4e2d\u8bfb\u53d6\u6216\u8005\u5411\u5176\u4e2d\u5199\u5165\u6570\u636e\uff0c\u53ef\u63d0\u4f9b\u7cbe\u786e\u4e00\u6b21\u7684\u5904\u7406\u8bed\u4e49\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/framework/connector/1.kafka.md",sourceDirName:"framework/connector",slug:"/framework/connector/kafka",permalink:"/zh-CN/docs/framework/connector/kafka",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/incubator-streampark-website/edit/dev/i18n/zh-CN/docusaurus-plugin-content-docs/current/framework/connector/1.kafka.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"kafka",title:"Apache Kafka Connector",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u5feb\u901f\u5f00\u59cb",permalink:"/zh-CN/docs/framework/quick-start"},next:{title:"JDBC Connector",permalink:"/zh-CN/docs/framework/connector/jdbc"}},d={},p=[{value:"\u4f9d\u8d56",id:"\u4f9d\u8d56",level:2},{value:"Kafka Source (Consumer)",id:"kafka-source-consumer",level:2},{value:"\u57fa\u7840\u6d88\u8d39\u793a\u4f8b",id:"\u57fa\u7840\u6d88\u8d39\u793a\u4f8b",level:3},{value:"\u9ad8\u7ea7\u914d\u7f6e\u53c2\u6570",id:"\u9ad8\u7ea7\u914d\u7f6e\u53c2\u6570",level:3},{value:"\u6d88\u8d39\u591a\u4e2aKafka\u5b9e\u4f8b",id:"\u6d88\u8d39\u591a\u4e2akafka\u5b9e\u4f8b",level:3},{value:"\u6d88\u8d39\u591a\u4e2aTopic",id:"\u6d88\u8d39\u591a\u4e2atopic",level:3},{value:"Topic \u53d1\u73b0",id:"topic-\u53d1\u73b0",level:3},{value:"\u914d\u7f6e\u5f00\u59cb\u6d88\u8d39\u7684\u4f4d\u7f6e",id:"\u914d\u7f6e\u5f00\u59cb\u6d88\u8d39\u7684\u4f4d\u7f6e",level:3},{value:"\u6307\u5b9a\u5206\u533aOffset",id:"\u6307\u5b9a\u5206\u533aoffset",level:3},{value:"\u6307\u5b9adeserializer",id:"\u6307\u5b9adeserializer",level:3},{value:"\u8fd4\u56de\u8bb0\u5f55KafkaRecord",id:"\u8fd4\u56de\u8bb0\u5f55kafkarecord",level:3},{value:"\u6307\u5b9astrategy",id:"\u6307\u5b9astrategy",level:3},{value:"Kafka Sink (Producer)",id:"kafka-sink-producer",level:2},{value:"\u5bb9\u9519\u548c\u8bed\u4e49",id:"\u5bb9\u9519\u548c\u8bed\u4e49",level:3},{value:"\u591a\u5b9e\u4f8bkafka\u6307\u5b9aalias",id:"\u591a\u5b9e\u4f8bkafka\u6307\u5b9aalias",level:3},{value:"\u6307\u5b9aSerializationSchema",id:"\u6307\u5b9aserializationschema",level:3},{value:"\u6307\u5b9apartitioner",id:"\u6307\u5b9apartitioner",level:3}];function h(e){const a={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=a;return s||function(e,a){throw new Error("Expected "+(a?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html",children:"Apache Flink\xae \u5b98\u65b9"}),"\u63d0\u4f9b\u4e86 ",(0,r.jsx)(a.a,{href:"http://kafka.apache.org",children:"Apache Kafka"})," \u7684\u8fde\u63a5\u5668\uff0c\u7528\u4e8e\u4ece Kafka \u4e3b\u9898\u4e2d\u8bfb\u53d6\u6216\u8005\u5411\u5176\u4e2d\u5199\u5165\u6570\u636e\uff0c\u53ef\u63d0\u4f9b",(0,r.jsx)(a.strong,{children:"\u7cbe\u786e\u4e00\u6b21"}),"\u7684\u5904\u7406\u8bed\u4e49\u3002"]}),"\n",(0,r.jsxs)(a.p,{children:["Apache StreamPark \u4e2d ",(0,r.jsx)(a.code,{children:"KafkaSource"})," \u548c ",(0,r.jsx)(a.code,{children:"KafkaSink"})," \u57fa\u4e8e\u5b98\u7f51\u7684 Kafka Connector \u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u5c4f\u853d\u4e86\u5f88\u591a\u7ec6\u8282\uff0c\u7b80\u5316\u5f00\u53d1\u6b65\u9aa4\uff0c\u8ba9\u6570\u636e\u7684\u8bfb\u53d6\u548c\u5199\u5165\u66f4\u7b80\u5355\u3002"]}),"\n",(0,r.jsx)(a.h2,{id:"\u4f9d\u8d56",children:"\u4f9d\u8d56"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html",children:"Apache Flink"})," \u96c6\u6210\u4e86\u901a\u7528\u7684 Kafka \u8fde\u63a5\u5668\uff0c\u5b83\u4f1a\u5c3d\u529b\u4e0e Kafka client \u7684\u6700\u65b0\u7248\u672c\u4fdd\u6301\u540c\u6b65\u3002\u8be5\u8fde\u63a5\u5668\u4f7f\u7528\u7684 Kafka client \u7248\u672c\u53ef\u80fd\u4f1a\u5728 Flink \u7248\u672c\u4e4b\u95f4\u53d1\u751f\u53d8\u5316\u3002\u5f53\u524d Kafka client \u5411\u540e\u517c\u5bb9 0.10.0 \u6216\u66f4\u9ad8\u7248\u672c\u7684 Kafka broker\u3002\u6709\u5173 Kafka \u517c\u5bb9\u6027\u7684\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003 ",(0,r.jsx)(a.a,{href:"https://kafka.apache.org/protocol.html#protocol_compatibility",children:"Apache Kafka"})," \u7684\u5b98\u65b9\u6587\u6863\u3002"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-xml",children:"\x3c!--\u5fc5\u987b\u8981\u5bfc\u5165\u7684\u4f9d\u8d56--\x3e\n<dependency>\n    <groupId>org.apache.streampark</groupId>\n    <artifactId>streampark-flink-core</artifactId>\n    <version>${project.version}</version>\n</dependency>\n\n\x3c!--flink-connector--\x3e\n<dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-connector-kafka_2.11</artifactId>\n    <version>1.12.0</version>\n</dependency>\n\n"})}),"\n",(0,r.jsx)(a.p,{children:"\u540c\u65f6\uff0c\u5728\u5f00\u53d1\u9636\u6bb5\uff0c\u4ee5\u4e0b\u4f9d\u8d56\u4e5f\u662f\u5fc5\u8981\u7684\uff1a"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-xml",children:"\x3c!--\u4ee5\u4e0b scope \u4e3a provided \u7684\u4f9d\u8d56\u4e5f\u662f\u5fc5\u987b\u8981\u5bfc\u5165\u7684--\x3e\n<dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-scala_${scala.binary.version}</artifactId>\n    <version>${flink.version}</version>\n    <scope>provided</scope>\n</dependency>\n\n<dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-clients_${scala.binary.version}</artifactId>\n    <version>${flink.version}</version>\n    <scope>provided</scope>\n</dependency>\n\n<dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-streaming-scala_${scala.binary.version}</artifactId>\n    <version>${flink.version}</version>\n    <scope>provided</scope>\n</dependency>\n\n"})}),"\n",(0,r.jsx)(a.h2,{id:"kafka-source-consumer",children:"Kafka Source (Consumer)"}),"\n",(0,r.jsxs)(a.p,{children:["\u5148\u4ecb\u7ecd\u57fa\u4e8e\u5b98\u7f51\u7684\u6807\u51c6\u7684 kafka \u6d88\u8d39\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u4ee3\u7801\u6458\u81ea ",(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/kafka.html#kafka-consumer",children:"Apache Kafka \u5b98\u7f51\u6587\u6863"})]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'val properties = new Properties()\nproperties.setProperty("bootstrap.servers", "localhost:9092")\nproperties.setProperty("group.id", "test")\nval stream = env.addSource(new FlinkKafkaConsumer[String]("topic", new SimpleStringSchema(), properties))\n'})}),"\n",(0,r.jsx)(a.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e0a\u6765\u5b9a\u4e49\u4e86\u4e00\u5806 Kafka \u7684\u8fde\u63a5\u4fe1\u606f\u3002\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0c\u5404\u9879\u53c2\u6570\u90fd\u662f\u786c\u7f16\u7801\u7684\u65b9\u5f0f\u5199\u6b7b\u7684\uff0c\u975e\u5e38\u4e0d\u7075\u654f\u3002\u4e0b\u9762\uff0c\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u7528 StreamPark \u63a5\u5165 Kafka \u7684\u6570\u636e\u3002\u53ea\u9700\u8981\u6309\u7167\u89c4\u5b9a\u7684\u683c\u5f0f\u5b9a\u4e49\u597d\u914d\u7f6e\u6587\u4ef6\u7136\u540e\u7f16\u5199\u4ee3\u7801\u5373\u53ef\uff0c\u914d\u7f6e\u548c\u4ee3\u7801\u4ecb\u7ecd\u5982\u4e0b\u3002"}),"\n",(0,r.jsx)(a.h3,{id:"\u57fa\u7840\u6d88\u8d39\u793a\u4f8b",children:"\u57fa\u7840\u6d88\u8d39\u793a\u4f8b"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.source:\n  bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n  topic: test_user\n  group.id: user_01\n  auto.offset.reset: earliest\n  enable.auto.commit: true\n"})}),"\n",(0,r.jsx)(a.admonition,{title:"\u6ce8\u610f\u4e8b\u9879",type:"info",children:(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"kafka.source"})," \u8fd9\u4e2a\u524d\u7f00\u662f\u56fa\u5b9a\u7684\u3002Kafka properties \u76f8\u5173\u7684\u53c2\u6570\u5fc5\u987b\u9075\u5b88 ",(0,r.jsx)(a.a,{href:"http://kafka.apache.org",children:"Apache Kafka \u5b98\u7f51\u6587\u6863"})," \u5bf9\u53c2\u6570\u7684\u8bbe\u7f6e\u89c4\u8303\u3002"]})}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"scala",label:"Scala",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:"package org.apache.streampark.flink.quickstart\n\nimport org.apache.streampark.flink.core.scala.FlinkStreaming\nimport org.apache.streampark.flink.core.scala.sink.JdbcSink\nimport org.apache.streampark.flink.core.scala.source.KafkaSource\nimport org.apache.flink.api.scala._\n\nobject kafkaSourceApp extends FlinkStreaming {\n    override def handle(): Unit = {\n        val source = KafkaSource().getDataStream[String]()\n        print(source)\n    }\n}\n"})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"import org.apache.streampark.flink.core.java.function.StreamEnvConfigFunction;\nimport org.apache.streampark.flink.core.java.source.KafkaSource;\nimport org.apache.streampark.flink.core.scala.StreamingContext;\nimport org.apache.streampark.flink.core.scala.source.KafkaRecord;\nimport org.apache.streampark.flink.core.scala.util.StreamEnvConfig;\nimport org.apache.flink.api.common.functions.MapFunction;\nimport org.apache.flink.streaming.api.datastream.DataStream;\n\npublic class KafkaSimpleJavaApp {\n    public static void main(String[] args) {\n        StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n        StreamingContext context = new StreamingContext(envConfig);\n        DataStream<String> source = new KafkaSource<String>(context)\n                .getDataStream()\n                .map((MapFunction<KafkaRecord<String>, String>) KafkaRecord::value);\n        source.print();\n        context.start();\n    }\n}\n"})})})]}),"\n",(0,r.jsx)(a.h3,{id:"\u9ad8\u7ea7\u914d\u7f6e\u53c2\u6570",children:"\u9ad8\u7ea7\u914d\u7f6e\u53c2\u6570"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"KafkaSource"})," \u662f\u57fa\u4e8e Flink Kafka Connector \u5c01\u88c5\u4e00\u4e2a\u66f4\u7b80\u5355\u7684 Kafka \u8bfb\u53d6\u7c7b\u3002\u5176\u6784\u9020\u65b9\u6cd5\u9700\u8981\u4f20\u5165 ",(0,r.jsx)(a.code,{children:"StreamingContext"}),"\u3002\u5f53\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u4f20\u5165\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\uff0c\u6846\u67b6\u4f1a\u81ea\u52a8\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u3002"]}),"\n",(0,r.jsxs)(a.p,{children:["\u5728 ",(0,r.jsx)(a.code,{children:"new KafkaSource"})," \u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u7684\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\uff0c\u521d\u59cb\u5316\u5e76\u8fd4\u56de\u4e00\u4e2a Kafka Consumer \u5b9e\u4f8b\u3002\u4e0a\u9762\u4f8b\u5b50\u53ea\u914d\u7f6e\u4e86\u4e00\u4e2a topic\uff0c\u56e0\u6b64\u5728\u6d88\u8d39\u7684\u65f6\u5019\u4e0d\u7528\u6307\u5b9a topic \u76f4\u63a5\u9ed8\u8ba4\u83b7\u53d6\u8fd9\u4e2a topic \u6765\u6d88\u8d39,\u3002\u8fd9\u53ea\u662f\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u66f4\u591a\u66f4\u590d\u6742\u7684\u89c4\u5219\u548c\u8bfb\u53d6\u64cd\u4f5c\u5219\u8981\u901a\u8fc7 ",(0,r.jsx)(a.code,{children:".getDataStream()"})," \u5728\u8be5\u65b9\u6cd5\u91cc\u4f20\u5165\u53c2\u6570\u624d\u80fd\u5b9e\u73b0\u3002"]}),"\n",(0,r.jsxs)(a.p,{children:["\u6211\u4eec\u770b\u770b ",(0,r.jsx)(a.code,{children:"getDataStream"})," \u8fd9\u4e2a\u65b9\u6cd5\u7684\u7b7e\u540d\uff1a"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'def getDataStream[T: TypeInformation](topic: java.io.Serializable = null,\n    alias: String = "",\n    deserializer: KafkaDeserializationSchema[T],\n    strategy: WatermarkStrategy[KafkaRecord[T]] = null\n): DataStream[KafkaRecord[T]]\n'})}),"\n",(0,r.jsx)(a.p,{children:"\u53c2\u6570\u5177\u4f53\u4f5c\u7528\u5982\u4e0b\uff1a"}),"\n",(0,r.jsxs)(a.table,{children:[(0,r.jsx)(a.thead,{children:(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u53c2\u6570\u540d"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u53c2\u6570\u7c7b\u578b"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u4f5c\u7528"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u9ed8\u8ba4\u503c"})]})}),(0,r.jsxs)(a.tbody,{children:[(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"topic"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"Serializable"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u4e00\u4e2atopic\u6216\u8005\u4e00\u7ec4topic"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u65e0"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"alias"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u7528\u4e8e\u533a\u522b\u4e0d\u540c\u7684kafka\u5b9e\u4f8b"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u65e0"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"deserializer"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"DeserializationSchema"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"topic\u91cc\u6570\u636e\u7684\u5177\u4f53\u89e3\u6790\u7c7b"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"KafkaStringDeserializationSchema"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"strategy"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"WatermarkStrategy"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"watermark\u751f\u6210\u7b56\u7565"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(a.p,{children:"\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u66f4\u591a\u7684\u4f7f\u7528\u548c\u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,r.jsx)("div",{class:"counter",children:(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"\u6d88\u8d39\u591a\u4e2aKafka\u5b9e\u4f8b"}),"\n",(0,r.jsx)(a.li,{children:"\u6d88\u8d39\u591a\u4e2aTopic"}),"\n",(0,r.jsx)(a.li,{children:"Topic\u52a8\u6001\u53d1\u73b0"}),"\n",(0,r.jsx)(a.li,{children:"\u4ece\u6307\u5b9aOffset\u6d88\u8d39"}),"\n",(0,r.jsx)(a.li,{children:"\u6307\u5b9aKafkaDeserializationSchema"}),"\n",(0,r.jsx)(a.li,{children:"\u6307\u5b9aWatermarkStrategy"}),"\n"]})}),"\n",(0,r.jsx)(a.h3,{id:"\u6d88\u8d39\u591a\u4e2akafka\u5b9e\u4f8b",children:"\u6d88\u8d39\u591a\u4e2aKafka\u5b9e\u4f8b"}),"\n",(0,r.jsxs)(a.p,{children:["\u5728\u6846\u67b6\u5f00\u53d1\u4e4b\u521d\u5c31\u8003\u8651\u5230\u4e86\u591a\u4e2a\u4e0d\u540c\u5b9e\u4f8b\u7684kafka\u7684\u914d\u7f6e\u60c5\u51b5.\u5982\u4f55\u6765\u7edf\u4e00\u914d\u7f6e,\u5e76\u4e14\u89c4\u8303\u683c\u5f0f\u5462?\u5728streampark\u4e2d\u662f\u8fd9\u4e48\u89e3\u51b3\u7684,\u5047\u5982\u6211\u4eec\u8981\u540c\u65f6\u6d88\u8d39\u4e24\u4e2a\u4e0d\u540c\u5b9e\u4f8b\u7684kafka,\u914d\u7f6e\u6587\u4ef6\u5b9a\u4e49\u5982\u4e0b,\n\u53ef\u4ee5\u770b\u5230\u5728 ",(0,r.jsx)(a.code,{children:"kafka.source"})," \u4e0b\u76f4\u63a5\u653ekafka\u7684\u5b9e\u4f8b\u540d\u79f0(\u540d\u5b57\u53ef\u4ee5\u4efb\u610f),\u5728\u8fd9\u91cc\u6211\u4eec\u7edf\u4e00\u79f0\u4e3a ",(0,r.jsx)(a.strong,{children:"alias"})," , ",(0,r.jsx)(a.strong,{children:"alias"})," \u5fc5\u987b\u662f\u552f\u4e00\u7684,\u6765\u533a\u522b\u4e0d\u540c\u7684\u5b9e\u4f8b,\u7136\u540e\u522b\u7684\u53c2\u6570\u8fd8\u662f\u6309\u7167\u4e4b\u524d\u7684\u89c4\u8303,\n\u7edf\u7edf\u653e\u5230\u5f53\u524d\u8fd9\u4e2a\u5b9e\u4f8b\u7684 ",(0,r.jsx)(a.code,{children:"namespace"})," \u4e0b\u5373\u53ef.\u5982\u679c\u53ea\u6709\u4e00\u4e2akafka\u5b9e\u4f8b,\u5219\u53ef\u4ee5\u4e0d\u7528\u914d\u7f6e ",(0,r.jsx)(a.code,{children:"alias"}),"\n\u5728\u5199\u4ee3\u7801\u6d88\u8d39\u65f6\u6ce8\u610f\u6307\u5b9a\u5bf9\u5e94\u7684 ",(0,r.jsx)(a.strong,{children:"alias"})," \u5373\u53ef,\u914d\u7f6e\u548c\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"\u914d\u7f6e",label:"\u914d\u7f6e",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.source:\n  kafka1:\n    bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n    topic: test_user\n    group.id: user_01\n    auto.offset.reset: earliest\n    enable.auto.commit: true\n  kafka2:\n    bootstrap.servers: kfk4:9092,kfk5:9092,kfk6:9092\n    topic: kafka2\n    group.id: kafka2\n    auto.offset.reset: earliest\n    enable.auto.commit: true\n"})})}),(0,r.jsx)(c.A,{value:"Scala",label:"Scala",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'//\u6d88\u8d39kafka1\u5b9e\u4f8b\u7684\u6570\u636e\nKafkaSource().getDataStream[String](alias = "kafka1")\n  .uid("kfkSource1")\n  .name("kfkSource1")\n  .print()\n\n//\u6d88\u8d39kafka2\u5b9e\u4f8b\u7684\u6570\u636e\nKafkaSource().getDataStream[String](alias = "kafka2")\n  .uid("kfkSource2")\n  .name("kfkSource2")\n  .print()\n\n'})})}),(0,r.jsxs)(c.A,{value:"Java",label:"Java",children:[(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\nStreamingContext context = new StreamingContext(envConfig);\n\n//\u6d88\u8d39kafka1\u5b9e\u4f8b\u7684\u6570\u636e\nDataStream<String> source1 = new KafkaSource<String>(context)\n        .alias("kafka1")\n        .getDataStream()\n        print();\n\n//\u6d88\u8d39kafka1\u5b9e\u4f8b\u7684\u6570\u636e\nDataStream<String> source2 = new KafkaSource<String>(context)\n        .alias("kafka2")\n        .getDataStream()\n        .print();\n\ncontext.start();\n'})}),(0,r.jsx)(a.admonition,{title:"\u7279\u522b\u6ce8\u610f",type:"danger",children:(0,r.jsxs)(a.p,{children:["java api\u5728\u7f16\u5199\u4ee3\u7801\u65f6,\u4e00\u5b9a\u8981\u5c06",(0,r.jsx)(a.code,{children:"alias"}),"\u7b49\u8fd9\u4e9b\u53c2\u6570\u7684\u8bbe\u7f6e\u653e\u5230\u8c03\u7528",(0,r.jsx)(a.code,{children:".getDataStream()"}),"\u4e4b\u524d"]})})]})]}),"\n",(0,r.jsx)(a.h3,{id:"\u6d88\u8d39\u591a\u4e2atopic",children:"\u6d88\u8d39\u591a\u4e2aTopic"}),"\n",(0,r.jsxs)(a.p,{children:["\u914d\u7f6e\u6d88\u8d39\u591a\u4e2atopic\u4e5f\u5f88\u7b80\u5355,\u5728\u914d\u7f6e\u6587\u4ef6",(0,r.jsx)(a.code,{children:"topic"}),"\u4e0b\u914d\u7f6e\u591a\u4e2atopic\u540d\u79f0\u5373\u53ef,\u7528",(0,r.jsx)(a.code,{children:","}),"\u6216\u7a7a\u683c\u5206\u9694,\u4ee3\u7801\u6d88\u8d39\u5904\u7406\u7684\u65f6\u5019\u6307\u5b9atopic\u53c2\u6570\u5373\u53ef,",(0,r.jsx)(a.code,{children:"scala"})," api\u4e0b\u5982\u679c\u662f\u6d88\u8d39\u4e00\u4e2atopic,\u5219\u76f4\u63a5\u4f20\u5165topic\u540d\u79f0\u5373\u53ef,\u5982\u679c\u8981\u6d88\u8d39\u591a\u4e2a,\u4f20\u5165\u4e00\u4e2a",(0,r.jsx)(a.code,{children:"List"}),"\u5373\u53ef\n",(0,r.jsx)(a.code,{children:"java"}),"api\u901a\u8fc7 ",(0,r.jsx)(a.code,{children:"topic()"}),"\u65b9\u6cd5\u4f20\u5165\u8981\u6d88\u8d39topic\u7684\u540d\u79f0,\u662f\u4e00\u4e2aString\u7c7b\u578b\u7684\u53ef\u53d8\u53c2\u6570,\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u6216\u591a\u4e2a",(0,r.jsx)(a.code,{children:"topic"}),"\u540d\u79f0,\u914d\u7f6e\u548c\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"\u914d\u7f6e",label:"\u914d\u7f6e",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.source:\n  bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n  topic: topic1,topic2,topic3...\n  group.id: user_01\n  auto.offset.reset: earliest # (earliest | latest)\n  ...\n"})})}),(0,r.jsx)(c.A,{value:"Scala",label:"Scala",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'//\u6d88\u8d39\u6307\u5b9a\u5355\u4e2atopic\u7684\u6570\u636e\nKafkaSource().getDataStream[String](topic = "topic1")\n  .uid("kfkSource1")\n  .name("kfkSource1")\n  .print()\n\n//\u6d88\u8d39\u4e00\u6279topic\u6570\u636e\nKafkaSource().getDataStream[String](topic = List("topic1","topic2","topic3"))\n.uid("kfkSource1")\n.name("kfkSource1")\n.print()\n\n'})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'//\u6d88\u8d39\u6307\u5b9a\u5355\u4e2atopic\u7684\u6570\u636e\nDataStream<String> source1 = new KafkaSource<String>(context)\n        .topic("topic1")\n        .getDataStream()\n        .print();\n\n//\u6d88\u8d39\u4e00\u7ec4topic\u7684\u6570\u636e\nDataStream<String> source1 = new KafkaSource<String>(context)\n        .topic("topic1","topic2")\n        .getDataStream()\n        .print();\n\n'})})})]}),"\n",(0,r.jsx)(a.admonition,{title:"\u63d0\u793a",type:"tip",children:(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"topic"}),"\u652f\u6301\u914d\u7f6e\u591a\u4e2a",(0,r.jsx)(a.code,{children:"topic"}),"\u5b9e\u4f8b,\u6bcf\u4e2a",(0,r.jsx)(a.code,{children:"topic"}),"\u76f4\u63a5\u7528",(0,r.jsx)(a.code,{children:","}),"\u5206\u9694\u6216\u8005\u7a7a\u683c\u5206\u9694,\u5982\u679ctopic\u4e0b\u914d\u7f6e\u591a\u4e2a\u5b9e\u4f8b,\u5728\u6d88\u8d39\u7684\u65f6\u5fc5\u987b\u6307\u5b9a\u5177\u4f53\u7684topic\u540d\u79f0"]})}),"\n",(0,r.jsx)(a.h3,{id:"topic-\u53d1\u73b0",children:"Topic \u53d1\u73b0"}),"\n",(0,r.jsxs)(a.p,{children:["\u5173\u4e8ekafka\u7684\u5206\u533a\u52a8\u6001,\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u662f\u7981\u7528\u4e86\u5206\u533a\u53d1\u73b0\u7684\u3002\u82e5\u8981\u542f\u7528\u5b83\uff0c\u8bf7\u5728\u63d0\u4f9b\u7684\u5c5e\u6027\u914d\u7f6e\u4e2d\u4e3a ",(0,r.jsx)(a.code,{children:"flink.partition-discovery.interval-millis"})," \u8bbe\u7f6e\u5927\u4e8e ",(0,r.jsx)(a.code,{children:"0"}),",\u8868\u793a\u53d1\u73b0\u5206\u533a\u7684\u95f4\u9694\u662f\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u7684\n\u66f4\u591a\u8be6\u60c5\u8bf7\u53c2\u8003",(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#partition-discovery",children:"\u5b98\u7f51\u6587\u6863"})]}),"\n",(0,r.jsxs)(a.p,{children:["Flink Kafka Consumer \u8fd8\u80fd\u591f\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u57fa\u4e8e Topic \u540d\u79f0\u7684\u6a21\u5f0f\u5339\u914d\u6765\u53d1\u73b0 Topic,\u8be6\u60c5\u8bf7\u53c2\u8003",(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#topic-discovery",children:"\u5b98\u7f51\u6587\u6863"}),"\n\u5728",(0,r.jsx)(a.code,{children:"StreamPark"}),"\u4e2d\u63d0\u4f9b\u66f4\u7b80\u5355\u7684\u65b9\u5f0f,\u5177\u4f53\u9700\u8981\u5728 ",(0,r.jsx)(a.code,{children:"pattern"}),"\u4e0b\u914d\u7f6e\u8981\u5339\u914d\u7684",(0,r.jsx)(a.code,{children:"topic"}),"\u5b9e\u4f8b\u540d\u79f0\u7684\u6b63\u5219\u5373\u53ef"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"\u914d\u7f6e",label:"\u914d\u7f6e",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.source:\n  bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n  pattern: ^topic[1-9]\n  group.id: user_02\n  auto.offset.reset: earliest # (earliest | latest)\n  ...\n"})})}),(0,r.jsx)(c.A,{value:"Scala",label:"Scala",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'//\u6d88\u8d39\u6b63\u5219topic\u6570\u636e\nKafkaSource().getDataStream[String](topic = "topic-a")\n.uid("kfkSource1")\n.name("kfkSource1")\n.print()\n'})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\nStreamingContext context = new StreamingContext(envConfig);\n\n//\u6d88\u8d39\u901a\u914d\u7b26topic\u6570\u636e\nnew KafkaSource<String>(context)\n        .topic("topic-a")\n        .getDataStream()\n        .print();\n\ncontext.start();\n'})})})]}),"\n",(0,r.jsx)(a.admonition,{title:"\u7279\u522b\u6ce8\u610f",type:"danger",children:(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"topic"}),"\u548c",(0,r.jsx)(a.code,{children:"pattern"}),"\u4e0d\u80fd\u540c\u65f6\u914d\u7f6e,\u5f53\u914d\u7f6e\u4e86",(0,r.jsx)(a.code,{children:"pattern"}),"\u6b63\u5219\u5339\u914d\u65f6,\u5728\u6d88\u8d39\u7684\u65f6\u5019\u4f9d\u7136\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u786e\u5b9a\u7684",(0,r.jsx)(a.code,{children:"topic"}),"\u540d\u79f0,\u6b64\u65f6\u4f1a\u68c0\u67e5",(0,r.jsx)(a.code,{children:"pattern"}),"\u662f\u5426\u5339\u914d\u5f53\u524d\u7684",(0,r.jsx)(a.code,{children:"topic"}),",\u5982\u4e0d\u5339\u914d\u5219\u4f1a\u62a5\u9519"]})}),"\n",(0,r.jsx)(a.h3,{id:"\u914d\u7f6e\u5f00\u59cb\u6d88\u8d39\u7684\u4f4d\u7f6e",children:"\u914d\u7f6e\u5f00\u59cb\u6d88\u8d39\u7684\u4f4d\u7f6e"}),"\n",(0,r.jsxs)(a.p,{children:["Flink Kafka Consumer \u5141\u8bb8\u901a\u8fc7\u914d\u7f6e\u6765\u786e\u5b9a Kafka \u5206\u533a\u7684\u8d77\u59cb\u4f4d\u7f6e,",(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#kafka-consumers-start-position-configuration",children:"\u5b98\u7f51\u6587\u6863"}),"Kafka \u5206\u533a\u7684\u8d77\u59cb\u4f4d\u7f6e\u5177\u4f53\u64cd\u4f5c\u65b9\u5f0f\u5982\u4e0b"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"scala",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:"val env = StreamExecutionEnvironment.getExecutionEnvironment()\nval myConsumer = new FlinkKafkaConsumer[String](...)\nmyConsumer.setStartFromEarliest()      // \u5c3d\u53ef\u80fd\u4ece\u6700\u65e9\u7684\u8bb0\u5f55\u5f00\u59cb\nmyConsumer.setStartFromLatest()        // \u4ece\u6700\u65b0\u7684\u8bb0\u5f55\u5f00\u59cb\nmyConsumer.setStartFromTimestamp(...)  // \u4ece\u6307\u5b9a\u7684\u65f6\u95f4\u5f00\u59cb\uff08\u6beb\u79d2\uff09\nmyConsumer.setStartFromGroupOffsets()  // \u9ed8\u8ba4\u7684\u65b9\u6cd5\n\nval stream = env.addSource(myConsumer)\n...\n"})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\nFlinkKafkaConsumer<String> myConsumer = new FlinkKafkaConsumer<>(...);\nmyConsumer.setStartFromEarliest();     // \u5c3d\u53ef\u80fd\u4ece\u6700\u65e9\u7684\u8bb0\u5f55\u5f00\u59cb\nmyConsumer.setStartFromLatest();       // \u4ece\u6700\u65b0\u7684\u8bb0\u5f55\u5f00\u59cb\nmyConsumer.setStartFromTimestamp(...); // \u4ece\u6307\u5b9a\u7684\u65f6\u95f4\u5f00\u59cb\uff08\u6beb\u79d2\uff09\nmyConsumer.setStartFromGroupOffsets(); // \u9ed8\u8ba4\u7684\u65b9\u6cd5\n\nDataStream<String> stream = env.addSource(myConsumer);\n...\n"})})})]}),"\n",(0,r.jsxs)(a.p,{children:["\u5728",(0,r.jsx)(a.code,{children:"StreamPark"}),"\u4e2d\u4e0d\u63a8\u8350\u8fd9\u79cd\u65b9\u5f0f\u8fdb\u884c\u8bbe\u5b9a,\u63d0\u4f9b\u4e86\u66f4\u65b9\u4fbf\u7684\u65b9\u5f0f,\u53ea\u9700\u8981\u5728\u914d\u7f6e\u91cc\u6307\u5b9a ",(0,r.jsx)(a.code,{children:"auto.offset.reset"})," \u5373\u53ef"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"earliest"})," \u4ece\u6700\u65e9\u7684\u8bb0\u5f55\u5f00\u59cb"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"latest"})," \u4ece\u6700\u65b0\u7684\u8bb0\u5f55\u5f00\u59cb"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"\u6307\u5b9a\u5206\u533aoffset",children:"\u6307\u5b9a\u5206\u533aOffset"}),"\n",(0,r.jsxs)(a.p,{children:["\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5206\u533a\u6307\u5b9a consumer \u5e94\u8be5\u5f00\u59cb\u6d88\u8d39\u7684\u5177\u4f53 offset,\u53ea\u9700\u8981\u6309\u7167\u5982\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e",(0,r.jsx)(a.code,{children:"start.from"}),"\u76f8\u5173\u7684\u4fe1\u606f\u5373\u53ef"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.source:\n  bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n  topic: topic1,topic2,topic3...\n  group.id: user_01\n  auto.offset.reset: earliest # (earliest | latest)\n  start.from:\n    timestamp: 1591286400000 #\u6307\u5b9atimestamp,\u9488\u5bf9\u6240\u6709\u7684topic\u751f\u6548\n    offset: # \u7ed9topic\u7684partition\u6307\u5b9aoffset\n      topic: topic_abc,topic_123\n      topic_abc: 0:182,1:183,2:182 #\u5206\u533a0\u4ece182\u5f00\u59cb\u6d88\u8d39,\u5206\u533a1\u4ece183\u5f00\u59cb,\u5206\u533a2\u4ece182\u5f00\u59cb...\n      topic_123: 0:182,1:183,2:182\n  ...\n"})}),"\n",(0,r.jsx)(a.h3,{id:"\u6307\u5b9adeserializer",children:"\u6307\u5b9adeserializer"}),"\n",(0,r.jsxs)(a.p,{children:["\u9ed8\u8ba4\u4e0d\u6307\u5b9a",(0,r.jsx)(a.code,{children:"deserializer"}),"\u5219\u5728\u5185\u90e8\u91c7\u7528String\u7684\u65b9\u5f0f\u53cd\u5e8f\u5217\u5316topic\u4e2d\u7684\u6570\u636e,\u53ef\u4ee5\u624b\u52a8\u6307\u5b9a",(0,r.jsx)(a.code,{children:"deserializer"}),",\u8fd9\u6837\u53ef\u4ee5\u4e00\u6b65\u76f4\u63a5\u8fd4\u56de\u76ee\u6807",(0,r.jsx)(a.code,{children:"DataStream"}),",\u5177\u4f53\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"Scala",label:"Scala",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:"import org.apache.streampark.common.util.JsonUtils\nimport org.apache.streampark.flink.core.scala.FlinkStreaming\nimport org.apache.streampark.flink.core.scala.sink.JdbcSink\nimport org.apache.streampark.flink.core.scala.source.KafkaSource\nimport org.apache.flink.api.common.typeinfo.TypeInformation\nimport org.apache.flink.api.java.typeutils.TypeExtractor.getForClass\nimport org.apache.flink.api.scala._\nimport org.apache.flink.streaming.connectors.kafka.KafkaDeserializationSchema\n\nobject KafkaSourceApp extends FlinkStreaming {\n\n  override def handle(): Unit = {\n        KafkaSource()\n          .getDataStream[String](deserializer = new UserSchema)\n          .map(_.value)\n          .print()\n  }\n\n}\n\nclass UserSchema extends KafkaDeserializationSchema[User] {\n  override def isEndOfStream(nextElement: User): Boolean = false\n  override def getProducedType: TypeInformation[User] = getForClass(classOf[User])\n  override def deserialize(record: ConsumerRecord[Array[Byte], Array[Byte]]): User = {\n    val value = new String(record.value())\n    JsonUtils.read[User](value)\n  }\n}\n\ncase class User(name:String,age:Int,gender:Int,address:String)\n\n"})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"import com.fasterxml.jackson.databind.ObjectMapper;\nimport org.apache.streampark.flink.core.java.function.StreamEnvConfigFunction;\nimport org.apache.streampark.flink.core.java.source.KafkaSource;\nimport org.apache.streampark.flink.core.scala.StreamingContext;\nimport org.apache.streampark.flink.core.scala.source.KafkaRecord;\nimport org.apache.streampark.flink.core.scala.util.StreamEnvConfig;\nimport org.apache.flink.api.common.functions.MapFunction;\nimport org.apache.flink.api.common.typeinfo.TypeInformation;\nimport org.apache.flink.streaming.connectors.kafka.KafkaDeserializationSchema;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\n\nimport java.io.Serializable;\n\nimport static org.apache.flink.api.java.typeutils.TypeExtractor.getForClass;\n\npublic class KafkaSourceJavaApp {\n\n    public static void main(String[] args) {\n        StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n        StreamingContext context = new StreamingContext(envConfig);\n        new KafkaSource<JavaUser>(context)\n                .deserializer(new JavaUserSchema())\n                .getDataStream()\n                .map((MapFunction<KafkaRecord<JavaUser>, JavaUser>) KafkaRecord::value)\n                .print();\n\n        context.start();\n    }\n\n}\n\nclass JavaUserSchema implements KafkaDeserializationSchema<JavaUser> {\n    private ObjectMapper mapper = new ObjectMapper();\n    @Override public boolean isEndOfStream(JavaUser nextElement) return false;\n    @Override public TypeInformation<JavaUser> getProducedType() return getForClass(JavaUser.class);\n    @Override public JavaUser deserialize(ConsumerRecord<byte[], byte[]> record) throws Exception {\n        String value = new String(record.value());\n        return mapper.readValue(value, JavaUser.class);\n    }\n}\n\nclass JavaUser implements Serializable {\n    String name;\n    Integer age;\n    Integer gender;\n    String address;\n}\n"})})})]}),"\n",(0,r.jsx)(a.h3,{id:"\u8fd4\u56de\u8bb0\u5f55kafkarecord",children:"\u8fd4\u56de\u8bb0\u5f55KafkaRecord"}),"\n",(0,r.jsxs)(a.p,{children:["\u8fd4\u56de\u7684\u5bf9\u8c61\u88ab\u5305\u88c5\u5728",(0,r.jsx)(a.code,{children:"KafkaRecord"}),"\u4e2d,",(0,r.jsx)(a.code,{children:"kafkaRecord"}),"\u4e2d\u6709\u5f53\u524d\u7684",(0,r.jsx)(a.code,{children:"offset"}),",",(0,r.jsx)(a.code,{children:"partition"}),",",(0,r.jsx)(a.code,{children:"timestamp"}),"\u7b49\u8bf8\u591a\u6709\u7528\u7684\u4fe1\u606f\u4f9b\u5f00\u53d1\u8005\u4f7f\u7528,\u5176\u4e2d",(0,r.jsx)(a.code,{children:"value"}),"\u5373\u8fd4\u56de\u7684\u76ee\u6807\u5bf9\u8c61,\u5982\u4e0b\u56fe:"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{src:n(93308).A+"",width:"1936",height:"1196"})}),"\n",(0,r.jsx)(a.h3,{id:"\u6307\u5b9astrategy",children:"\u6307\u5b9astrategy"}),"\n",(0,r.jsxs)(a.p,{children:["\u5728\u8bb8\u591a\u573a\u666f\u4e2d,\u8bb0\u5f55\u7684\u65f6\u95f4\u6233\u662f(\u663e\u5f0f\u6216\u9690\u5f0f)\u5d4c\u5165\u5230\u8bb0\u5f55\u672c\u8eab\u4e2d\u3002\u6b64\u5916,\u7528\u6237\u53ef\u80fd\u5e0c\u671b\u5b9a\u671f\u6216\u4ee5\u4e0d\u89c4\u5219\u7684\u65b9\u5f0f",(0,r.jsx)(a.code,{children:"Watermark"}),",\u4f8b\u5982\u57fa\u4e8e",(0,r.jsx)(a.code,{children:"Kafka"}),"\u6d41\u4e2d\u5305\u542b\u5f53\u524d\u4e8b\u4ef6\u65f6\u95f4\u7684",(0,r.jsx)(a.code,{children:"watermark"}),"\u7684\u7279\u6b8a\u8bb0\u5f55\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u60c5\u51b5\uff0c",(0,r.jsx)(a.code,{children:"Flink Kafka Consumer"}),"\u662f\u5141\u8bb8\u6307\u5b9a",(0,r.jsx)(a.code,{children:"AssignerWithPeriodicWatermarks"}),"\u6216",(0,r.jsx)(a.code,{children:"AssignerWithPunctuatedWatermarks"})]}),"\n",(0,r.jsxs)(a.p,{children:["\u5728",(0,r.jsx)(a.code,{children:"StreamPark"}),"\u4e2d\u8fd0\u884c\u4f20\u5165\u4e00\u4e2a",(0,r.jsx)(a.code,{children:"WatermarkStrategy"}),"\u4f5c\u4e3a\u53c2\u6570\u6765\u5206\u914d",(0,r.jsx)(a.code,{children:"Watermark"}),",\u5982\u4e0b\u9762\u7684\u793a\u4f8b,\u89e3\u6790",(0,r.jsx)(a.code,{children:"topic"}),"\u4e2d\u7684\u6570\u636e\u4e3a",(0,r.jsx)(a.code,{children:"user"}),"\u5bf9\u8c61,",(0,r.jsx)(a.code,{children:"user"}),"\u4e2d\u6709\u4e2a ",(0,r.jsx)(a.code,{children:"orderTime"})," \u662f\u65f6\u95f4\u7c7b\u578b,\u6211\u4eec\u4ee5\u8fd9\u4e2a\u4e3a\u57fa\u51c6,\u4e3a\u5176\u5206\u914d\u4e00\u4e2a",(0,r.jsx)(a.code,{children:"Watermark"})]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"Scala",label:"Scala",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:"import org.apache.streampark.common.util.JsonUtils\nimport org.apache.streampark.flink.core.scala.FlinkStreaming\nimport org.apache.streampark.flink.core.scala.source.{KafkaRecord, KafkaSource}\nimport org.apache.flink.api.common.eventtime.{SerializableTimestampAssigner, WatermarkStrategy}\nimport org.apache.flink.api.common.typeinfo.TypeInformation\nimport org.apache.flink.api.java.typeutils.TypeExtractor.getForClass\nimport org.apache.flink.api.scala._\nimport org.apache.flink.streaming.connectors.kafka.KafkaDeserializationSchema\nimport org.apache.kafka.clients.consumer.ConsumerRecord\n\nimport java.time.Duration\nimport java.util.Date\n\nobject KafkaSourceStrategyApp extends FlinkStreaming {\n\n  override def handle(): Unit = {\n    KafkaSource()\n      .getDataStream[User](\n        deserializer = new UserSchema,\n        strategy = WatermarkStrategy\n          .forBoundedOutOfOrderness[KafkaRecord[User]](Duration.ofMinutes(1))\n          .withTimestampAssigner(new SerializableTimestampAssigner[KafkaRecord[User]] {\n            override def extractTimestamp(element: KafkaRecord[User], recordTimestamp: Long): Long = {\n              element.value.orderTime.getTime\n            }\n          })\n      ).map(_.value)\n      .print()\n  }\n\n}\n\nclass UserSchema extends KafkaDeserializationSchema[User] {\n  override def isEndOfStream(nextElement: User): Boolean = false\n  override def getProducedType: TypeInformation[User] = getForClass(classOf[User])\n  override def deserialize(record: ConsumerRecord[Array[Byte], Array[Byte]]): User = {\n    val value = new String(record.value())\n    JsonUtils.read[User](value)\n  }\n}\n\ncase class User(name: String, age: Int, gender: Int, address: String, orderTime: Date)\n\n"})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"import com.fasterxml.jackson.databind.ObjectMapper;\nimport org.apache.streampark.flink.core.java.function.StreamEnvConfigFunction;\nimport org.apache.streampark.flink.core.java.source.KafkaSource;\nimport org.apache.streampark.flink.core.scala.StreamingContext;\nimport org.apache.streampark.flink.core.scala.source.KafkaRecord;\nimport org.apache.streampark.flink.core.scala.util.StreamEnvConfig;\nimport org.apache.flink.api.common.eventtime.SerializableTimestampAssigner;\nimport org.apache.flink.api.common.eventtime.WatermarkStrategy;\nimport org.apache.flink.api.common.functions.MapFunction;\nimport org.apache.flink.api.common.typeinfo.TypeInformation;\nimport org.apache.flink.streaming.connectors.kafka.KafkaDeserializationSchema;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\n\nimport java.io.Serializable;\nimport java.time.Duration;\nimport java.util.Date;\n\nimport static org.apache.flink.api.java.typeutils.TypeExtractor.getForClass;\n\n/**\n * @author benjobs\n */\npublic class KafkaSourceStrategyJavaApp {\n\n    public static void main(String[] args) {\n        StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n        StreamingContext context = new StreamingContext(envConfig);\n        new KafkaSource<JavaUser>(context)\n                .deserializer(new JavaUserSchema())\n                .strategy(\n                        WatermarkStrategy.<KafkaRecord<JavaUser>>forBoundedOutOfOrderness(Duration.ofMinutes(1))\n                                .withTimestampAssigner(\n                                        (SerializableTimestampAssigner<KafkaRecord<JavaUser>>)\n                                                (element, recordTimestamp) -> element.value().orderTime.getTime()\n                                )\n                )\n                .getDataStream()\n                .map((MapFunction<KafkaRecord<JavaUser>, JavaUser>) KafkaRecord::value)\n                .print();\n\n\n        context.start();\n    }\n\n}\n\nclass JavaUserSchema implements KafkaDeserializationSchema<JavaUser> {\n    private ObjectMapper mapper = new ObjectMapper();\n    @Override public boolean isEndOfStream(JavaUser nextElement) return false;\n    @Override public TypeInformation<JavaUser> getProducedType() return getForClass(JavaUser.class);\n    @Override public JavaUser deserialize(ConsumerRecord<byte[], byte[]> record) throws Exception {\n        String value = new String(record.value());\n        return mapper.readValue(value, JavaUser.class);\n    }\n}\n\nclass JavaUser implements Serializable {\n    String name;\n    Integer age;\n    Integer gender;\n    String address;\n    Date orderTime;\n}\n"})})})]}),"\n",(0,r.jsx)(a.admonition,{title:"\u6ce8\u610f\u4e8b\u9879",type:"info",children:(0,r.jsxs)(a.p,{children:["\u5982\u679c",(0,r.jsx)(a.code,{children:"watermark assigner"}),"\u4f9d\u8d56\u4e8e\u4ece",(0,r.jsx)(a.code,{children:"Kafka"}),"\u8bfb\u53d6\u7684\u6d88\u606f\u6765\u4e0a\u6da8\u5176",(0,r.jsx)(a.code,{children:"watermark"}),"(\u901a\u5e38\u5c31\u662f\u8fd9\u79cd\u60c5\u51b5),\u90a3\u4e48\u6240\u6709\u4e3b\u9898\u548c\u5206\u533a\u90fd\u9700\u8981\u6709\u8fde\u7eed\u7684\u6d88\u606f\u6d41\u3002\u5426\u5219, ",(0,r.jsxs)(a.strong,{children:["\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684",(0,r.jsx)(a.code,{children:"watermark"}),"\u5c06\u65e0\u6cd5\u4e0a\u6da8"]})," \uff0c\u6240\u6709\u57fa\u4e8e\u65f6\u95f4\u7684\u7b97\u5b50(\u4f8b\u5982\u65f6\u95f4\u7a97\u53e3\u6216\u5e26\u6709\u8ba1\u65f6\u5668\u7684\u51fd\u6570)\u4e5f\u65e0\u6cd5\u8fd0\u884c\u3002\u5355\u4e2a\u7684",(0,r.jsx)(a.code,{children:"Kafka"}),"\u5206\u533a\u4e5f\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u53cd\u5e94\u3002\u8003\u8651\u8bbe\u7f6e\u9002\u5f53\u7684 ",(0,r.jsx)(a.strong,{children:(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/event_timestamps_watermarks.html#dealing-with-idle-sources",children:(0,r.jsx)(a.code,{children:"idelness timeouts"})})})," \u6765\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u3002"]})}),"\n",(0,r.jsx)(a.h2,{id:"kafka-sink-producer",children:"Kafka Sink (Producer)"}),"\n",(0,r.jsxs)(a.p,{children:["\u5728",(0,r.jsx)(a.code,{children:"StreamPark"}),"\u4e2d",(0,r.jsx)(a.code,{children:"Kafka Producer"})," \u88ab\u79f0\u4e3a",(0,r.jsx)(a.code,{children:"KafkaSink"}),",\u5b83\u5141\u8bb8\u5c06\u6d88\u606f\u5199\u5165\u4e00\u4e2a\u6216\u591a\u4e2a",(0,r.jsx)(a.code,{children:"Kafka topic\u4e2d"})]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"Scala",label:"Scala",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:" val source = KafkaSource().getDataStream[String]().map(_.value)\n KafkaSink().sink(source)\n"})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:" StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n StreamingContext context = new StreamingContext(envConfig);\n DataStream<String> source = new KafkaSource<String>(context)\n         .getDataStream()\n         .map((MapFunction<KafkaRecord<String>, String>) KafkaRecord::value);\n\n new KafkaSink<String>(context).sink(source);\n\n context.start();\n"})})})]}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"sink"}),"\u662f\u5177\u4f53\u7684\u5199\u5165\u6570\u636e\u7684\u65b9\u6cd5,\u53c2\u6570\u5217\u8868\u5982\u4e0b"]}),"\n",(0,r.jsxs)(a.table,{children:[(0,r.jsx)(a.thead,{children:(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u53c2\u6570\u540d"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u53c2\u6570\u7c7b\u578b"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u4f5c\u7528"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u9ed8\u8ba4\u503c"}),(0,r.jsx)(a.th,{style:{textAlign:"left"},children:"\u5fc5\u987b"})]})}),(0,r.jsxs)(a.tbody,{children:[(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"stream"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"DataStream[T]"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u8981\u5199\u7684\u6570\u636e\u6d41"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u65e0"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"yes"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"alias"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsxs)(a.td,{style:{textAlign:"left"},children:[(0,r.jsx)(a.code,{children:"kafka"}),"\u7684\u5b9e\u4f8b\u522b\u540d"]}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u65e0"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"no"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"serializationSchema"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"SerializationSchema[T]"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"\u5199\u5165\u7684\u5e8f\u5217\u5316\u5668"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"SimpleStringSchema"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"no"})]}),(0,r.jsxs)(a.tr,{children:[(0,r.jsx)(a.td,{style:{textAlign:"left"},children:(0,r.jsx)(a.code,{children:"partitioner"})}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"FlinkKafkaPartitioner[T]"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"kafka\u5206\u533a\u5668"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"KafkaEqualityPartitioner[T]"}),(0,r.jsx)(a.td,{style:{textAlign:"left"},children:"no"})]})]})]}),"\n",(0,r.jsx)(a.h3,{id:"\u5bb9\u9519\u548c\u8bed\u4e49",children:"\u5bb9\u9519\u548c\u8bed\u4e49"}),"\n",(0,r.jsxs)(a.p,{children:["\u542f\u7528 Flink \u7684 ",(0,r.jsx)(a.code,{children:"checkpointing"})," \u540e\uff0c",(0,r.jsx)(a.code,{children:"KafkaSink"})," \u53ef\u4ee5\u63d0\u4f9b",(0,r.jsx)(a.code,{children:"\u7cbe\u786e\u4e00\u6b21"}),"\u7684\u8bed\u4e49\u4fdd\u8bc1,\u5177\u4f53\u5f00\u542f",(0,r.jsx)(a.code,{children:"checkpointing"}),"\u7684\u8bbe\u7f6e\u8bf7\u53c2\u8003\u7b2c\u4e8c\u7ae0\u5173\u4e8e",(0,r.jsx)(a.a,{href:"/docs/development/config/#checkpoints",children:"\u9879\u76ee\u914d\u7f6e"}),"\u90e8\u5206"]}),"\n",(0,r.jsxs)(a.p,{children:["\u9664\u4e86\u542f\u7528 Flink \u7684 checkpointing\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5c06\u9002\u5f53\u7684 ",(0,r.jsx)(a.code,{children:"semantic"})," \u53c2\u6570\u4f20\u9012\u7ed9 ",(0,r.jsx)(a.code,{children:"KafkaSink"})," \u6765\u9009\u62e9\u4e09\u79cd\u4e0d\u540c\u7684\u64cd\u4f5c\u6a21\u5f0f"]}),"\n",(0,r.jsx)("div",{class:"counter",children:(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"EXACTLY_ONCE  \u4f7f\u7528 Kafka \u4e8b\u52a1\u63d0\u4f9b\u7cbe\u786e\u4e00\u6b21\u8bed\u4e49"}),"\n",(0,r.jsx)(a.li,{children:"AT_LEAST_ONCE \u81f3\u5c11\u4e00\u6b21,\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u4e22\u5931\u4efb\u4f55\u8bb0\u5f55(\u4f46\u662f\u8bb0\u5f55\u53ef\u80fd\u4f1a\u91cd\u590d)"}),"\n",(0,r.jsx)(a.li,{children:"NONE Flink \u4e0d\u4f1a\u6709\u4efb\u4f55\u8bed\u4e49\u7684\u4fdd\u8bc1\uff0c\u4ea7\u751f\u7684\u8bb0\u5f55\u53ef\u80fd\u4f1a\u4e22\u5931\u6216\u91cd\u590d"}),"\n"]})}),"\n",(0,r.jsxs)(a.p,{children:["\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b,\u53ea\u9700\u8981\u5728",(0,r.jsx)(a.code,{children:"kafka.sink"}),"\u4e0b\u914d\u7f6e",(0,r.jsx)(a.code,{children:"semantic"}),"\u5373\u53ef"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.sink:\n    bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n    topic: kfk_sink\n    transaction.timeout.ms: 1000\n    semantic: AT_LEAST_ONCE # EXACTLY_ONCE|AT_LEAST_ONCE|NONE\n    batch.size: 1\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsxs)("summary",{children:[" kafka ",(0,r.jsx)("code",{children:"EXACTLY_ONCE"})," \u8bed\u4e49\u8bf4\u660e"]}),(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"Semantic.EXACTLY_ONCE"}),"\u6a21\u5f0f\u4f9d\u8d56\u4e8e\u4e8b\u52a1\u63d0\u4ea4\u7684\u80fd\u529b\u3002\u4e8b\u52a1\u63d0\u4ea4\u53d1\u751f\u4e8e\u89e6\u53d1 checkpoint \u4e4b\u524d\uff0c\u4ee5\u53ca\u4ece checkpoint \u6062\u590d\u4e4b\u540e\u3002\u5982\u679c\u4ece Flink \u5e94\u7528\u7a0b\u5e8f\u5d29\u6e83\u5230\u5b8c\u5168\u91cd\u542f\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 Kafka \u7684\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u90a3\u4e48\u5c06\u4f1a\u6709\u6570\u636e\u4e22\u5931\uff08Kafka \u4f1a\u81ea\u52a8\u4e22\u5f03\u8d85\u51fa\u8d85\u65f6\u65f6\u95f4\u7684\u4e8b\u52a1\uff09\u3002\u8003\u8651\u5230\u8fd9\u4e00\u70b9\uff0c\u8bf7\u6839\u636e\u9884\u671f\u7684\u5b95\u673a\u65f6\u95f4\u6765\u5408\u7406\u5730\u914d\u7f6e\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4\u3002"]}),(0,r.jsx)(a.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cKafka broker \u5c06 transaction.max.timeout.ms \u8bbe\u7f6e\u4e3a 15 \u5206\u949f\u3002\u6b64\u5c5e\u6027\u4e0d\u5141\u8bb8\u4e3a\u5927\u4e8e\u5176\u503c\u7684 producer \u8bbe\u7f6e\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cFlinkKafkaProducer \u5c06 producer config \u4e2d\u7684 transaction.timeout.ms \u5c5e\u6027\u8bbe\u7f6e\u4e3a 1 \u5c0f\u65f6\uff0c\u56e0\u6b64\u5728\u4f7f\u7528 Semantic.EXACTLY_ONCE \u6a21\u5f0f\u4e4b\u524d\u5e94\u8be5\u589e\u52a0 transaction.max.timeout.ms \u7684\u503c\u3002"}),(0,r.jsx)(a.p,{children:"\u5728 KafkaConsumer \u7684 read_committed \u6a21\u5f0f\u4e2d\uff0c\u4efb\u4f55\u672a\u7ed3\u675f\uff08\u65e2\u672a\u4e2d\u6b62\u4e5f\u672a\u5b8c\u6210\uff09\u7684\u4e8b\u52a1\u5c06\u963b\u585e\u6765\u81ea\u7ed9\u5b9a Kafka topic \u7684\u672a\u7ed3\u675f\u4e8b\u52a1\u4e4b\u540e\u7684\u6240\u6709\u8bfb\u53d6\u6570\u636e\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5728\u9075\u5faa\u5982\u4e0b\u4e00\u7cfb\u5217\u4e8b\u4ef6\u4e4b\u540e\uff1a"}),(0,r.jsx)("div",{class:"counter",children:(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"\u7528\u6237\u542f\u52a8\u4e86 transaction1 \u5e76\u4f7f\u7528\u5b83\u5199\u4e86\u4e00\u4e9b\u8bb0\u5f55"}),"\n",(0,r.jsx)(a.li,{children:"\u7528\u6237\u542f\u52a8\u4e86 transaction2 \u5e76\u4f7f\u7528\u5b83\u7f16\u5199\u4e86\u4e00\u4e9b\u5176\u4ed6\u8bb0\u5f55"}),"\n",(0,r.jsx)(a.li,{children:"\u7528\u6237\u63d0\u4ea4\u4e86 transaction2"}),"\n"]})}),(0,r.jsx)(a.p,{children:"\u5373\u4f7f transaction2 \u4e2d\u7684\u8bb0\u5f55\u5df2\u63d0\u4ea4\uff0c\u5728\u63d0\u4ea4\u6216\u4e2d\u6b62 transaction1 \u4e4b\u524d\uff0c\u6d88\u8d39\u8005\u4e5f\u4e0d\u4f1a\u770b\u5230\u8fd9\u4e9b\u8bb0\u5f55\u3002\u8fd9\u6709 2 \u5c42\u542b\u4e49\uff1a"}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"\u9996\u5148\uff0c\u5728 Flink \u5e94\u7528\u7a0b\u5e8f\u7684\u6b63\u5e38\u5de5\u4f5c\u671f\u95f4\uff0c\u7528\u6237\u53ef\u4ee5\u9884\u6599 Kafka \u4e3b\u9898\u4e2d\u751f\u6210\u7684\u8bb0\u5f55\u7684\u53ef\u89c1\u6027\u4f1a\u5ef6\u8fdf\uff0c\u76f8\u5f53\u4e8e\u5df2\u5b8c\u6210 checkpoint \u4e4b\u95f4\u7684\u5e73\u5747\u65f6\u95f4\u3002"}),"\n",(0,r.jsx)(a.li,{children:"\u5176\u6b21\uff0c\u5728 Flink \u5e94\u7528\u7a0b\u5e8f\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\uff0c\u6b64\u5e94\u7528\u7a0b\u5e8f\u6b63\u5728\u5199\u5165\u7684\u4f9b\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u4e3b\u9898\u5c06\u88ab\u963b\u585e\uff0c\u76f4\u5230\u5e94\u7528\u7a0b\u5e8f\u91cd\u65b0\u542f\u52a8\u6216\u914d\u7f6e\u7684\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4\u8fc7\u53bb\u540e\uff0c\u624d\u6062\u590d\u6b63\u5e38\u3002\u6b64\u6807\u6ce8\u4ec5\u9002\u7528\u4e8e\u6709\u591a\u4e2a agent \u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u5199\u5165\u540c\u4e00 Kafka \u4e3b\u9898\u7684\u60c5\u51b5\u3002"}),"\n"]}),(0,r.jsxs)(a.p,{children:["\u6ce8\u610f\uff1a",(0,r.jsx)(a.code,{children:"Semantic.EXACTLY_ONCE"})," \u6a21\u5f0f\u4e3a\u6bcf\u4e2a FlinkKafkaProducer \u5b9e\u4f8b\u4f7f\u7528\u56fa\u5b9a\u5927\u5c0f\u7684 KafkaProducer \u6c60\u3002\u6bcf\u4e2a checkpoint \u4f7f\u7528\u5176\u4e2d\u4e00\u4e2a producer\u3002\u5982\u679c\u5e76\u53d1 checkpoint \u7684\u6570\u91cf\u8d85\u8fc7\u6c60\u7684\u5927\u5c0f\uff0cFlinkKafkaProducer \u5c06\u629b\u51fa\u5f02\u5e38\uff0c\u5e76\u5bfc\u81f4\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5931\u8d25\u3002\u8bf7\u5408\u7406\u5730\u914d\u7f6e\u6700\u5927\u6c60\u5927\u5c0f\u548c\u6700\u5927\u5e76\u53d1 checkpoint \u6570\u91cf\u3002"]}),(0,r.jsxs)(a.p,{children:["\u6ce8\u610f\uff1a",(0,r.jsx)(a.code,{children:"Semantic.EXACTLY_ONCE"})," \u4f1a\u5c3d\u4e00\u5207\u53ef\u80fd\u4e0d\u7559\u4e0b\u4efb\u4f55\u9017\u7559\u7684\u4e8b\u52a1\uff0c\u5426\u5219\u4f1a\u963b\u585e\u5176\u4ed6\u6d88\u8d39\u8005\u4ece\u8fd9\u4e2a Kafka topic \u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u4f46\u662f\uff0c\u5982\u679c Flink \u5e94\u7528\u7a0b\u5e8f\u5728\u7b2c\u4e00\u6b21 checkpoint \u4e4b\u524d\u5c31\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u5728\u91cd\u65b0\u542f\u52a8\u6b64\u7c7b\u5e94\u7528\u7a0b\u5e8f\u540e\uff0c\u7cfb\u7edf\u4e2d\u4e0d\u4f1a\u6709\u5148\u524d\u6c60\u5927\u5c0f\uff08pool size\uff09\u76f8\u5173\u7684\u4fe1\u606f\u3002\u56e0\u6b64\uff0c\u5728\u7b2c\u4e00\u6b21 checkpoint \u5b8c\u6210\u524d\u5bf9 Flink \u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u7f29\u5bb9\uff0c\u4e14\u5e76\u53d1\u6570\u7f29\u5bb9\u500d\u6570\u5927\u4e8e\u5b89\u5168\u7cfb\u6570 FlinkKafkaProducer.SAFE_SCALE_DOWN_FACTOR \u7684\u503c\u7684\u8bdd\uff0c\u662f\u4e0d\u5b89\u5168\u7684\u3002"]})]}),"\n",(0,r.jsx)(a.h3,{id:"\u591a\u5b9e\u4f8bkafka\u6307\u5b9aalias",children:"\u591a\u5b9e\u4f8bkafka\u6307\u5b9aalias"}),"\n",(0,r.jsxs)(a.p,{children:["\u5982\u679c\u5199\u65f6\u6709\u591a\u4e2a\u4e0d\u540c\u5b9e\u4f8b\u7684kafka\u9700\u8981\u914d\u7f6e,\u540c\u6837\u91c7\u7528",(0,r.jsx)(a.code,{children:"alias"}),"\u6765\u533a\u522b\u4e0d\u7528\u7684kafka\u5b9e\u4f8b,\u914d\u7f6e\u5982\u4e0b:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"kafka.sink:\n    kafka_cluster1:\n        bootstrap.servers: kfk1:9092,kfk2:9092,kfk3:9092\n        topic: kfk_sink\n        transaction.timeout.ms: 1000\n        semantic: AT_LEAST_ONCE # EXACTLY_ONCE|AT_LEAST_ONCE|NONE\n        batch.size: 1\n    kafka_cluster2:\n        bootstrap.servers: kfk6:9092,kfk7:9092,kfk8:9092\n        topic: kfk_sink\n        transaction.timeout.ms: 1000\n        semantic: AT_LEAST_ONCE # EXACTLY_ONCE|AT_LEAST_ONCE|NONE\n        batch.size: 1\n"})}),"\n",(0,r.jsxs)(a.p,{children:["\u5728\u5199\u5165\u7684\u65f6\u5019,\u9700\u8981\u624b\u52a8\u6307\u5b9a",(0,r.jsx)(a.code,{children:"alias"}),",\u6ce8\u610f\u4e0b",(0,r.jsx)(a.code,{children:"scala"})," api\u548c",(0,r.jsx)(a.code,{children:"java"})," api\u5728\u4ee3\u7801\u4e0a\u7a0d\u6709\u4e0d\u540c,",(0,r.jsx)(a.code,{children:"scala"}),"\u76f4\u63a5\u5728",(0,r.jsx)(a.code,{children:"sink"}),"\u65b9\u6cd5\u91cc\u6307\u5b9a\u53c2\u6570,",(0,r.jsx)(a.code,{children:"java"})," api\u5219\u662f\u901a\u8fc7",(0,r.jsx)(a.code,{children:"alias()"}),"\u65b9\u6cd5\u6765\u8bbe\u7f6e,\u5176\u5e95\u5c42\u5b9e\u73b0\u662f\u5b8c\u5168\u4e00\u81f4\u7684"]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"Scala",label:"Scala",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:' val source = KafkaSource().getDataStream[String]().map(_.value)\n KafkaSink().sink(source,alias = "kafka_cluster1")\n'})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:' StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n StreamingContext context = new StreamingContext(envConfig);\n DataStream<String> source = new KafkaSource<String>(context)\n         .getDataStream()\n         .map((MapFunction<KafkaRecord<String>, String>) KafkaRecord::value);\n\n new KafkaSink<String>(context).alias("kafka_cluster1").sink(source);\n\n context.start();\n'})})})]}),"\n",(0,r.jsx)(a.h3,{id:"\u6307\u5b9aserializationschema",children:"\u6307\u5b9aSerializationSchema"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:" Flink Kafka Producer"})," \u9700\u8981\u77e5\u9053\u5982\u4f55\u5c06 Java/Scala \u5bf9\u8c61\u8f6c\u5316\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\u3002 KafkaSerializationSchema \u5141\u8bb8\u7528\u6237\u6307\u5b9a\u8fd9\u6837\u7684schema, \u76f8\u5173\u64cd\u4f5c\u65b9\u5f0f\u548c\u6587\u6863\u8bf7\u53c2\u8003",(0,r.jsx)(a.a,{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/dev/connectors/kafka.html#the-serializationschema",children:"\u5b98\u7f51\u6587\u6863"})]}),"\n",(0,r.jsxs)(a.p,{children:["\u5728",(0,r.jsx)(a.code,{children:"KafkaSink"}),"\u91cc\u9ed8\u8ba4\u4e0d\u6307\u5b9a\u5e8f\u5217\u5316\u65b9\u5f0f,\u91c7\u7528\u7684\u662f",(0,r.jsx)(a.code,{children:"SimpleStringSchema"}),"\u6765\u8fdb\u884c\u5e8f\u5217\u5316,\u8fd9\u91cc\u5f00\u53d1\u8005\u53ef\u4ee5\u663e\u793a\u7684\u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5e8f\u5217\u5316\u5668,\u901a\u8fc7",(0,r.jsx)(a.code,{children:"serializationSchema"}),"\u53c2\u6570\u6307\u5b9a\u5373\u53ef,\u4f8b\u5982,\u5c06",(0,r.jsx)(a.code,{children:"user"}),"\u5bf9\u8c61\u5b89\u88c5\u81ea\u5b9a\u4e49\u7684\u683c\u5f0f\u5199\u5165",(0,r.jsx)(a.code,{children:"kafka"})]}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(c.A,{value:"scala",label:"Scala",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-scala",children:'import org.apache.streampark.common.util.JsonUtils\nimport org.apache.streampark.flink.core.scala.FlinkStreaming\nimport org.apache.flink.api.common.serialization.SerializationSchema\nimport org.apache.streampark.flink.core.scala.sink.JdbcSink\nimport org.apache.streampark.flink.core.scala.source.KafkaSource\nimport org.apache.flink.api.scala._\n\nobject KafkaSinkApp extends FlinkStreaming {\n\noverride def handle(): Unit = {\nval source = KafkaSource()\n.getDataStream[String]()\n.map(x => JsonUtils.read[User](x.value))\n\n    KafkaSink().sink[User](source, serialization = new SerializationSchema[User]() {\n      override def serialize(user: User): Array[Byte] = {\n        s"${user.name},${user.age},${user.gender},${user.address}".getBytes\n      }\n    })\n\n}\n\n}\n\ncase class User(name: String, age: Int, gender: Int, address: String)\n'})})}),(0,r.jsx)(c.A,{value:"Java",label:"Java",children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'import com.fasterxml.jackson.databind.ObjectMapper;\nimport org.apache.streampark.flink.core.java.function.StreamEnvConfigFunction;\nimport org.apache.streampark.flink.core.java.sink.KafkaSink;\nimport org.apache.streampark.flink.core.java.source.KafkaSource;\nimport org.apache.streampark.flink.core.scala.StreamingContext;\nimport org.apache.streampark.flink.core.scala.source.KafkaRecord;\nimport org.apache.streampark.flink.core.scala.util.StreamEnvConfig;\nimport org.apache.flink.api.common.functions.FilterFunction;\nimport org.apache.flink.api.common.functions.MapFunction;\nimport org.apache.flink.api.common.serialization.SerializationSchema;\nimport org.apache.flink.streaming.api.datastream.DataStream;\n\nimport java.io.Serializable;\n\npublic class kafkaSinkJavaApp {\n\n    public static void main(String[] args) {\n\n        StreamEnvConfig envConfig = new StreamEnvConfig(args, null);\n        StreamingContext context = new StreamingContext(envConfig);\n        ObjectMapper mapper = new ObjectMapper();\n\n        DataStream<JavaUser> source = new KafkaSource<String>(context)\n                .getDataStream()\n                .map((MapFunction<KafkaRecord<String>, JavaUser>) value ->\n                        mapper.readValue(value.value(), JavaUser.class));\n\n        new KafkaSink<JavaUser>(context)\n                .serializer(\n                        (SerializationSchema<JavaUser>) element ->\n                                String.format("%s,%d,%d,%s", element.name, element.age, element.gender, element.address).getBytes()\n                ).sink(source);\n\n        context.start();\n    }\n\n}\n\nclass JavaUser implements Serializable {\n    String name;\n    Integer age;\n    Integer gender;\n    String address;\n}\n'})})})]}),"\n",(0,r.jsx)(a.h3,{id:"\u6307\u5b9apartitioner",children:"\u6307\u5b9apartitioner"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"KafkaSink"}),"\u5141\u8bb8\u663e\u793a\u7684\u6307\u5b9a\u4e00\u4e2akafka\u5206\u533a\u5668,\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u4f7f\u7528",(0,r.jsx)(a.code,{children:"StreamPark"}),"\u5185\u7f6e\u7684 ",(0,r.jsx)(a.strong,{children:"KafkaEqualityPartitioner"})," \u5206\u533a\u5668,\u987e\u540d\u601d\u4e49,\u8be5\u5206\u533a\u5668\u53ef\u4ee5\u5747\u5300\u7684\u5c06\u6570\u636e\u5199\u5230\u5404\u4e2a\u5206\u533a\u4e2d\u53bb,",(0,r.jsx)(a.code,{children:"scala"})," api\u662f\u901a\u8fc7",(0,r.jsx)(a.code,{children:"partitioner"}),"\u53c2\u6570\u6765\u8bbe\u7f6e\u5206\u533a\u5668,\n",(0,r.jsx)(a.code,{children:"java"})," api\u4e2d\u662f\u901a\u8fc7",(0,r.jsx)(a.code,{children:"partitioner()"}),"\u65b9\u6cd5\u6765\u8bbe\u7f6e\u7684"]}),"\n",(0,r.jsx)(a.admonition,{title:"\u6ce8\u610f\u4e8b\u9879",type:"tip",children:(0,r.jsxs)(a.p,{children:["Flink Kafka Connector\u4e2d\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f ",(0,r.jsx)(a.strong,{children:"FlinkFixedPartitioner"})," \u5206\u533a\u5668,\u8be5\u5206\u533a\u5668\u9700\u8981\u7279\u522b\u6ce8\u610f",(0,r.jsx)(a.code,{children:"sink"}),"\u7684\u5e76\u884c\u5ea6\u548c",(0,r.jsx)(a.code,{children:"kafka"}),"\u7684\u5206\u533a\u6570,\u4e0d\u7136\u4f1a\u51fa\u73b0\u5f80\u4e00\u4e2a\u5206\u533a\u5199"]})})]})}function k(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},24990:(e,a,n)=>{n.d(a,{A:()=>c});n(30758);var r=n(13526);const t={tabItem:"tabItem_Xevx"};var i=n(86070);function c(e){let{children:a,hidden:n,className:c}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(t.tabItem,c),hidden:n,children:a})}},60630:(e,a,n)=>{n.d(a,{A:()=>b});var r=n(30758),t=n(13526),i=n(72469),c=n(25557),s=n(99688),l=n(17822),o=n(54991),d=n(52629);function p(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:a,children:n}=e;return(0,r.useMemo)((()=>{const e=a??function(e){return p(e).map((e=>{let{props:{value:a,label:n,attributes:r,default:t}}=e;return{value:a,label:n,attributes:r,default:t}}))}(n);return function(e){const a=(0,o.X)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,n])}function k(e){let{value:a,tabValues:n}=e;return n.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:n}=e;const t=(0,c.W6)(),i=function(e){let{queryString:a=!1,groupId:n}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:a,groupId:n});return[(0,l.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const a=new URLSearchParams(t.location.search);a.set(i,e),t.replace({...t.location,search:a.toString()})}),[i,t])]}function f(e){const{defaultValue:a,queryString:n=!1,groupId:t}=e,i=h(e),[c,l]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!k({value:a,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:a,tabValues:i}))),[o,p]=m({queryString:n,groupId:t}),[f,u]=function(e){let{groupId:a}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(a),[t,i]=(0,d.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:t}),x=(()=>{const e=o??f;return k({value:e,tabValues:i})?e:null})();(0,s.A)((()=>{x&&l(x)}),[x]);return{selectedValue:c,selectValue:(0,r.useCallback)((e=>{if(!k({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),p(e),u(e)}),[p,u,i]),tabValues:i}}var u=n(78820);const x={tabList:"tabList_wCRy",tabItem:"tabItem_v3ez"};var g=n(86070);function j(e){let{className:a,block:n,selectedValue:r,selectValue:c,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,i.a_)(),d=e=>{const a=e.currentTarget,n=l.indexOf(a),t=s[n].value;t!==r&&(o(a),c(t))},p=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;a=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;a=l[n]??l[l.length-1];break}}a?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},a),children:s.map((e=>{let{value:a,label:n,attributes:i}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===a?0:-1,"aria-selected":r===a,ref:e=>l.push(e),onKeyDown:p,onClick:d,...i,className:(0,t.A)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":r===a}),children:n??a},a)}))})}function S(e){let{lazy:a,children:n,selectedValue:t}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(a){const e=i.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:i.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==t})))})}function v(e){const a=f(e);return(0,g.jsxs)("div",{className:(0,t.A)("tabs-container",x.tabList),children:[(0,g.jsx)(j,{...a,...e}),(0,g.jsx)(S,{...a,...e})]})}function b(e){const a=(0,u.A)();return(0,g.jsx)(v,{...e,children:p(e.children)},String(a))}},93308:(e,a,n)=>{n.d(a,{A:()=>r});const r=n.p+"assets/images/streampark_kafkaapi-c3eb75726e1ec7cb8788dea846c54933.jpeg"},76113:(e,a,n)=>{n.d(a,{R:()=>c,x:()=>s});var r=n(30758);const t={},i=r.createContext(t);function c(e){const a=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function s(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:a},e.children)}}}]);