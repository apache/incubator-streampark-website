<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">自如基于 Apache StreamPark™ + Paimon 实现数据一键入湖最佳实践 | Apache StreamPark (incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://streampark.apache.org/zh-CN/blog/streampark-flink-with-paimon-in-ziru"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="自如基于 Apache StreamPark™ + Paimon 实现数据一键入湖最佳实践 | Apache StreamPark (incubating)"><meta data-rh="true" name="description" content="导读：本文主要介绍了自如 MySQL 数据迁移至 Hive 的架构升级演进，原有架构涉及到的组件众多，链路复杂，遇到很多挑战，在使用 StreamPark + Paimon 这套组合方案后有效地解决了数据集成中遇到的困境和挑战，分享了 StreamPark + Paimon 在实际应用中具体的实践方案，以及这套新秀组合方案带来的优势和收益。"><meta data-rh="true" property="og:description" content="导读：本文主要介绍了自如 MySQL 数据迁移至 Hive 的架构升级演进，原有架构涉及到的组件众多，链路复杂，遇到很多挑战，在使用 StreamPark + Paimon 这套组合方案后有效地解决了数据集成中遇到的困境和挑战，分享了 StreamPark + Paimon 在实际应用中具体的实践方案，以及这套新秀组合方案带来的优势和收益。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-10-18T07:44:07.000Z"><meta data-rh="true" property="article:tag" content="StreamPark,生产实践"><link data-rh="true" rel="icon" href="/zh-CN/image/favicon.ico"><link data-rh="true" rel="canonical" href="https://streampark.apache.org/zh-CN/blog/streampark-flink-with-paimon-in-ziru"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/blog/streampark-flink-with-paimon-in-ziru" hreflang="en"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/zh-CN/blog/streampark-flink-with-paimon-in-ziru" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://streampark.apache.org/blog/streampark-flink-with-paimon-in-ziru" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache StreamPark (incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache StreamPark (incubating) Atom Feed"><link rel="stylesheet" href="/zh-CN/assets/css/styles.973b1f1a.css">
<script src="/zh-CN/assets/js/runtime~main.470707f1.js" defer="defer"></script>
<script src="/zh-CN/assets/js/main.ef599892.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_BCtO" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/image/logo.png" alt="StreamPark Logo" class="themedComponent_Cvhi themedComponent--light_uT2j"><img src="/zh-CN/image/logo.png" alt="StreamPark Logo" class="themedComponent_Cvhi themedComponent--dark_ENih"></div><b class="navbar__title text--truncate">StreamPark</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-CN/docs/get-started/intro">文档</a><a class="navbar__item navbar__link" href="/zh-CN/download">下载</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">社区</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">行为守则</a></li><li><a class="dropdown__link" href="/zh-CN/community/contribution_guide/mailing_lists">加入邮件列表</a></li><li><a class="dropdown__link" href="/zh-CN/community/contribution_guide/become_committer">成为 Committer</a></li><li><a class="dropdown__link" href="/zh-CN/community/contribution_guide/become_pmc_member">成为 PMC 成员</a></li><li><a class="dropdown__link" href="/zh-CN/community/contribution_guide/new_committer_process">新的 Committer 流程</a></li><li><a class="dropdown__link" href="/zh-CN/community/contribution_guide/new_pmc_ember_process">新的 PMC 成员流程</a></li><li><a class="dropdown__link" href="/zh-CN/community/submit_guide/document">文档</a></li><li><a class="dropdown__link" href="/zh-CN/community/submit_guide/submit_code">提交代码</a></li><li><a class="dropdown__link" href="/zh-CN/community/submit_guide/code_style_and_quality_guide">代码风格和质量指南</a></li><li><a class="dropdown__link" href="/zh-CN/community/submit_guide/documentation_style_guide">文档书写规范</a></li><li><a class="dropdown__link" href="/zh-CN/community/release/how_to_release_version_2.1.x">How to release version 2.1.x</a></li><li><a class="dropdown__link" href="/zh-CN/community/release/how_to_verify_release">如何验证发版</a></li></ul></div><a class="navbar__item navbar__link" href="/zh-CN/team">团队</a><a class="navbar__item navbar__link" href="/zh-CN/user">用户</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">基金会</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">证书</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">事件</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">安全</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">赞助</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">致谢</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/blog">博客</a><a href="https://github.com/apache/incubator-streampark/issues/507" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">FAQ</a><a href="https://github.com/apache/incubator-streampark" target="_blank" class="githubStars_qnS9"><div class="githubStarsContainer_O7dk"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1.75C4.27062 1.75 1.25 4.77062 1.25 8.5C1.25 11.4869 3.18219 14.0097 5.86531 14.9041C6.20281 14.9631 6.32937 14.7606 6.32937 14.5834C6.32937 14.4231 6.32094 13.8916 6.32094 13.3263C4.625 13.6384 4.18625 12.9128 4.05125 12.5331C3.97531 12.3391 3.64625 11.74 3.35938 11.5797C3.12312 11.4531 2.78562 11.1409 3.35094 11.1325C3.8825 11.1241 4.26219 11.6219 4.38875 11.8244C4.99625 12.8453 5.96656 12.5584 6.35469 12.3813C6.41375 11.9425 6.59094 11.6472 6.785 11.4784C5.28312 11.3097 3.71375 10.7275 3.71375 8.14563C3.71375 7.41156 3.97531 6.80406 4.40563 6.33156C4.33812 6.16281 4.10187 5.47094 4.47312 4.54281C4.47312 4.54281 5.03844 4.36563 6.32937 5.23469C6.86937 5.08281 7.44313 5.00687 8.01688 5.00687C8.59063 5.00687 9.16438 5.08281 9.70438 5.23469C10.9953 4.35719 11.5606 4.54281 11.5606 4.54281C11.9319 5.47094 11.6956 6.16281 11.6281 6.33156C12.0584 6.80406 12.32 7.40312 12.32 8.14563C12.32 10.7359 10.7422 11.3097 9.24031 11.4784C9.485 11.6894 9.69594 12.0944 9.69594 12.7272C9.69594 13.63 9.6875 14.3556 9.6875 14.5834C9.6875 14.7606 9.81406 14.9716 10.1516 14.9041C12.8178 14.0097 14.75 11.4784 14.75 8.5C14.75 4.77062 11.7294 1.75 8 1.75Z" fill="currentColor"></path></svg><span class="githubText_YlX6">3.9k</span></div></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg></a><ul class="dropdown__menu"><li><a href="/blog/streampark-flink-with-paimon-in-ziru" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-CN/blog/streampark-flink-with-paimon-in-ziru" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">简体中文</a></li></ul></div><a class="colorModeButton_yITp undefined"><svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"></path></svg></a><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_SuYZ"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_HgBb searchBarLoadingRing_om0w"><div></div><div></div><div></div><div></div></div></div></div><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_pmYA"><div class="container-wrapper blog-container"><div class="container margin-vert--lg"><div class="row"><aside class="col col--2 overflow-hidden" style="opacity:0;transform:translateX(-100px) translateZ(0)"><nav class="sidebar_brwN thin-scrollbar" aria-label="最近博文导航"><div class="backButton_MCHS"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M8 7v4L2 6l6-5v4h5a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12H8Z"></path></svg></div><a class="sidebarItemTitle_r4Q1 margin-bottom--sm" href="/zh-CN/blog">近期文章</a><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-flink-on-k8s">Apache StreamPark™ Flink on Kubernetes 实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/flink-development-framework-streampark">Flink 开发利器 Apache StreamPark™</a></li><li class="sidebarItem_lnhn"><a aria-current="page" class="sidebarItemLink_yNGZ sidebarItemLinkActive_oSRm" href="/zh-CN/blog/streampark-flink-with-paimon-in-ziru">自如基于 Apache StreamPark™ + Paimon 实现数据一键入湖最佳实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-tianyancha">Apache StreamPark™ 助力天眼查实时平台建设｜效率数倍提升</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-joymaker">Apache StreamPark™ 在欢乐互娱的云原生平台实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-chinaunion">联通 Flink 实时计算平台化运维实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-bondex-with-paimon">海程邦达基于 Apache Paimon + Apache StreamPark™ 的流式数仓实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-shunwang">Apache StreamPark™ 在顺网科技的大规模生产实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-dustess">Apache StreamPark™ 在尘锋信息的最佳实践，化繁为简极致体验</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-joyme">Apache StreamPark™ 在 Joyme 的生产实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-haibo">Apache StreamPark™ 一站式计算利器在海博科技的生产实践，助力智慧城市建设</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-ziru">自如基于Apache StreamPark™ 的实时计算平台实践</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/zh-CN/blog/streampark-usercase-changan">长安汽车从自研平台到Apache StreamPark™ 的升级实践</a></li></ul></nav></aside><main class="col col--8 overflow-hidden" itemscope="" itemtype="http://schema.org/Blog"><div><div class="row" style="margin:0"><div class="col col--12 article__details article-bg"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="导读：本文主要介绍了自如 MySQL 数据迁移至 Hive 的架构升级演进，原有架构涉及到的组件众多，链路复杂，遇到很多挑战，在使用 StreamPark + Paimon 这套组合方案后有效地解决了数据集成中遇到的困境和挑战，分享了 StreamPark + Paimon 在实际应用中具体的实践方案，以及这套新秀组合方案带来的优势和收益。"><header><h1 class="margin-bottom--md blogPostTitle_thoQ text--center post--titleLink" itemprop="headline">自如基于 Apache StreamPark™ + Paimon 实现数据一键入湖最佳实践</h1><div class="margin-vert--md"><time datetime="2024-10-18T07:44:07.000Z" itemprop="datePublished"></time> · <!-- -->阅读需 20 分钟</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/new_cover-5991f0d6d5ee86bc8716862748caf484.png" width="1080" height="460" class="img__KcZ"></p>
<p><strong>导读</strong>：本文主要介绍了自如 MySQL 数据迁移至 Hive 的架构升级演进，原有架构涉及到的组件众多，链路复杂，遇到很多挑战，在使用 StreamPark + Paimon 这套组合方案后有效地解决了数据集成中遇到的困境和挑战，分享了 StreamPark + Paimon 在实际应用中具体的实践方案，以及这套新秀组合方案带来的优势和收益。</p>
<p>StreamPark: <a href="https://github.com/apache/streampark" target="_blank" rel="noopener noreferrer">https://github.com/apache/streampark</a></p>
<p>Paimon: <a href="https://github.com/apache/paimon" target="_blank" rel="noopener noreferrer">https://github.com/apache/paimon</a></p>
<p>欢迎关注、Star、Fork，参与贡献</p>
<p>供稿单位｜北京自如信息科技有限公司</p>
<p>文章作者｜刘涛、梁研生、魏林子</p>
<p>文章整理｜杨林伟</p>
<p>内容校对｜潘月鹏</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="1数据集成业务背景"><strong>1.数据集成业务背景</strong><a href="#1数据集成业务背景" class="hash-link" aria-label="1数据集成业务背景的直接链接" title="1数据集成业务背景的直接链接">​</a></h2>
<p>自如租房业务的数据集成场景主要来源于各业务线的 MySQL 表同步到 Hive 表的需求。这一需求包含了每天同步的 MySQL 业务表数量超过 4400 个，以及超过 8000 多个的 Hive ETL 加工任务，每天新产生数据量有 50T，而且这些数字还在不断增长 。根据数据的新鲜度需求分为低新鲜度（T+1 day）和高新鲜度（T+10 minutes）两种，每天同步调度 4000 多个低新鲜度数据表，以及每天同步调度 400 多个高新鲜度数据表，用以确保数据的及时性和准确性。</p>
<p>自如的数据集成方案根据业务使用场景主要可分为两种：</p>
<ul>
<li>
<p><strong>低新鲜度</strong>：低新鲜度对数据的时效性要求是 <strong>T+1day</strong>，每日定时凌晨 00:00 采用 Hive jdbc handler 进行 MySQL 数据的全量拉取至 Hive，其基本流程如下图所示：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="361" height="41" class="img__KcZ"></p>
</li>
<li>
<p><strong>高新鲜度</strong>：此场景中要求数据实效性是 <strong>T+10minutes</strong>，我们复用了低新鲜度场景的快照拉取方法来实现全量数据的获取，并且初始化至 MySQL，同步利用 Canal 解析日志收集到 Kafka，然后使用 Flink 读取 kafka 中的数据并写入到 HDFS，最后用 Airflow 进行调度以合并增量数据至 Hive，其基本逻辑如下所示：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnIAAAApCAYAAACx+MSIAAAO00lEQVR4Xu2dSagdRRuG7zaLQBbBlRBw4cKFC0EQRBDBhREjIoqIoiCCivKrwRHn6XdGUHGMiwgqEsUJRaKCijiLs+I8xilRYzSTQ/15ylMnfd97zr2p091fdd//e6C5p6u7z/n6faurvq6uc+7U1HSWLl68ePWCBQs2bHsdfJm+oAv6bHu9dKpbuG+zLO5bPxf3rZ+L+9atpcN+1MG9HMWiRYtWLlmyZP2KFSvCmjVrgjMTdEEfdEIv1bAE7tvcuG/9xH3rJ+5bt+iiH3VwL8d4ScGyZcvW60HOeNBrhpDGuG/5uG/9xH3rJ+5bt+iCH3VwL7ejXi4lu9OdnLlBN/Sr1DNL3LcJcd/6ifvWT9y3blHYjzq4l8LQS563MlTn5INug+fV5rhvk+O+9RP3rZ+4b92ipB91cC9nMvSSyXP/b8+ZmwLdBpMtzXHfJsd96yfuWz9x37pFST/q4F7OpOqlbnMyQD+pb1ZoKE4G6KeCGqGhOBmgnwpqhIbiZIB+KqgRGooTivpRBz0NJ2z3UsudDJKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkNxMkA/FdQIDcXJAP1UUCM0FCcU9aMOehpO8ESuEZKIBdBQnAzQTwU1QkPpFJs3bw5//PGHFncG9FNBjdBQzMCPLnuyI6CfCmqEhmLOL7/8Ev78808tLgq6qFA9QE+jUf7555/O+bQjoEvr4pTg+eefDzvttJMWt0ISsQAaSq+5/PLLw1FHHaXFrYF+KqgRGkornH322eGMM87Q4lm58847w8KFC8Ntt9020fEWoJ8KaoSGYsINN9wQzxlPDj/88HD11VfHpI6yjz/+WHefRpc8JF7R0woNpVHm8uKYY46J29955514bb344ou6SxGISXTqA3oajbJ69eqw8847a3HkwgsvjF52EXRpXZwSPPfcc/GisSCJ2ALLty0LtbCChtJrLrvssnDkkUdqcWugnwraEJ3w7ayzzgrLly/X4lnZd999w5VXXhlfT3K8BeingjZEJ3xT9tlnn3DdddfF1yRyV111Vfj777/Ds88+O+coXZc8RD8VtCGK+jabF1u2bInn/corr8R1T+TmpKiXsyVyn332Wfjggw+0uBOgS+vibNq0Key5557xznL33XcPe++9d3jyySfDEUccEUfN+Ltx48Zw7bXXhpNOOml43FtvvRWP+/XXX8ODDz4YOxkuhKOPPjqsX78+7vPuu+/G99tll13CxRdfHPbff//w0UcfzZdEbtO2Zeu25b9Toyu3htIKDDVzN4JXu+22W7jxxhuH26644opYtuuuu4bTTjst/PXXX0O/Gd1hG97ccccdw2Meeuih2DnxfozAffPNN7F8HiVynfCt2olzLe21117xuoNRvlFGbPj1wAMPZB9vBTGqoA3RCd+qqCcpkePxN9fQ119/HV5++eVYTvtHJ7THHnsMk4XZPLSG81BBG8LMt1H1vurFG2+8EQ499NA4akpfd8ghh8Tzpj1kxK6ayD388MPxvSg7+OCD4/Hfffdd3PeLL76I+5x++unh+OOPj6/5HPwjoWgC4lKhOoCZl6MgkaNfOuecc4bX0quvvhq30Z/RR3Gd4X2CHATPeHyOf1yLvAe5CPXBAnRpXZw09Eylvf/++2NCxjoVlE6d1/fdd19sYHj922+/xeMQjCTtp59+iuUci9BcIOkOlffkYuHYAw44IO735ptvzpdE7j9T/1bsLduWzVMzK7eG0gq33npr1PKxxx4Ld999dzxfGpO33347Vlg85I6U1yTcyW8aO3w57rjj4joJHneo7HfTTTfFC4TKfuqpp8bPmUeJXCd8S534hx9+GP275JJLYvk437gB4no699xzw7fffpt9vBXoV9GySTrhWxX1JCVy6RpjO20ir2kHeU2bSWIB4zwsATFWtGwSE9/G1fuqF/Q7vKbt4+b1hRdeiOv0b+yXErn33nsvltP2vfTSS+HAAw+MvjFHiwTi3nvvja/Zn/1oN3kv1pu6aeJ9Kxp1BRMvx1G9lh599NGw3377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" width="626" height="41" class="img__KcZ"></p>
</li>
</ul>
<p>然而，当前架构存在着多方面的挑战和压力。首先是运维成本高昂，其次是计算压力、存储压力和网络压力都非常大。另外，虽然系统运行时间从 0:00 到 1:00 期间资源利用不充分，但其他时间段却面临着资源不足的情况。对此自如决定更新数据集成架构以提高系统的效率和稳定性。</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="2遇到的挑战"><strong>2.遇到的挑战</strong><a href="#2遇到的挑战" class="hash-link" aria-label="2遇到的挑战的直接链接" title="2遇到的挑战的直接链接">​</a></h2>
<p>在上述的两种场景中，我们在数据集成过程中遇到了以下挑战：</p>
<ul>
<li>
<p><strong>网络带宽超负荷问题</strong>：由于拉取任务达到 <strong>4000+</strong>，过多的镜像全量数据拉取对数据库网络带宽产生了巨大压力。</p>
</li>
<li>
<p><strong>资源利用率低效</strong>：上游数据从 MySQL 同步到 ODS 层表后，下游的加工表才能启动，导致在 0:00 到 1:00 之间，Hadoop 集群的 CPU 和内存资源并未得到充分利用。</p>
</li>
<li>
<p><strong>维护成本高昂</strong>：当数据库表结构发生改变时，需要同步修改 Airflow 脚本。否则，会出现不完整的字段，引起线上数据异常问题。</p>
</li>
<li>
<p><strong>问题排查困难</strong>：数据链路较长，当出现数据异常时，问题排查成本较高，问题可能出现在 Canal、Kafka、Flink、Airflow 调度中的任何一个环节，导致问题恢复时间长。</p>
</li>
<li>
<p><strong>Flink 作业难以统一管理</strong>：Flink 本身没有提供很好的部署和开发能力，在 Flink 任务数量增多后，管理和维护的时间成本也随之上升。</p>
</li>
</ul>
<p>为了解决上述问题，我们经过一系列调研后，决定采用 “<strong>StreamPark+Paimon</strong>” 的策略，那么选择它们的原因是什么呢？我们可以先看看它们的特性。</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="paimon-的核心特性"><strong>Paimon 的核心特性</strong><a href="#paimon-的核心特性" class="hash-link" aria-label="paimon-的核心特性的直接链接" title="paimon-的核心特性的直接链接">​</a></h3>
<p><strong>在经过对 Apache Hudi / Iceberg / Paimon 几个数据湖框架的调研和综合评估之后，我们决定使用 Apache Paimon</strong>，Apache Paimon 是一项流式数据湖存储技术，可以为用户提供高吞吐低延时的数据摄入，流式订阅和实时查询能力，支持使用 Flink 和 Spark 构建实时 Lakehouse 架构，支持批/流数据处理操作，创新性地将 Lake 格式与 LSM 结构相结合，将实时流式更新引入 Lake 架构中，具有以下优点：</p>
<ul>
<li>
<p><strong>统一的批处理和流处理</strong>：Paimon 支持批量写入、批量读取和流式操作，提供了灵活的数据处理方式。</p>
</li>
<li>
<p><strong>数据湖功能</strong>：作为数据湖存储系统，Paimon 具有低成本、高可靠性和可扩展的元数据等特性。</p>
</li>
<li>
<p><strong>丰富的合并引擎</strong>：Paimon 提供了多种合并引擎，可以根据需求选择保留最新数据、进行局部更新或进行聚合操作。</p>
</li>
<li>
<p><strong>自动生成变更日志</strong>：Paimon 支持多种 Changelog 生产者，能够自动生成正确完整的变更日志，简化流式任务分析。</p>
</li>
<li>
<p><strong>丰富的表类型</strong>：Paimon 支持主键表和仅追加表，以及多种表类型，如内部表、外部表、分区表和临时表。</p>
</li>
<li>
<p><strong>支持表结构变更同步</strong>：当数据源表结构发生变化时，Paimon 能自动识别并同步这些变化。</p>
</li>
</ul>
<p>Paimon 可以结合 Apache Spark™ 来使用，我们场景是 Paimon 结合 Flink 的方式，这样一来 “<strong>如何管理 4000+个 Flink 数据同步作业</strong>  ” 将会是我们面临的新问题。在全面调研了相关项目，经过各项维度综合评估后，<strong>我们决定采用 StreamPark</strong>，那么为什么选择 StremaPark 呢？</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="streampark-的核心特性"><strong>StreamPark 的核心特性</strong><a href="#streampark-的核心特性" class="hash-link" aria-label="streampark-的核心特性的直接链接" title="streampark-的核心特性的直接链接">​</a></h3>
<p>Apache StreamPark 是一个流处理开发管理框架，提供了一套快捷的API 用来开发 Flink/Spark 作业，此外还提供了一个一站式的流处理作业开发管理平台，从流处理作业开发到上线全生命周期都做了支持，StreamPark 主要包含下面这些核心特点：</p>
<ul>
<li>
<p><strong>流处理应用开发框架</strong>：基于 StreamPark，开发者可以轻松构建和管理流处理应用程序，更好地利用  Apache Flink® 去编写流处理应用程序。</p>
</li>
<li>
<p><strong>完善的作为管理能力</strong>：StreamPark 提供一站式流任务开发管理平台，支持了 Flink / Spark 从应用开发到调试、部署、运维等全生命周期的能力支持，让 Flink / Spark 作业变得简单。</p>
</li>
<li>
<p><strong>完成度高</strong>：StreamPark 支持了 Flink 多版本，可以做到一个平台灵活切换，同时支持 Flink 所的部署模式，有效解决了 Flink on YARN / K8s 部署过于繁琐的问题，通过自动化流程，简化了任务的构建、测试和部署流程，并提高了开发效率。</p>
</li>
<li>
<p><strong>丰富的管理 API</strong>：StreamPark 提供了作业操作的 API，包括作业创建、拷贝、构建、部署、基于 checkpoint/savepoint 的停止和启动等功能，使外部系统调用 Apache Flink® 任务变得易于实现。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="3-streampark--paimon-实践"><strong>3. StreamPark + Paimon 实践</strong><a href="#3-streampark--paimon-实践" class="hash-link" aria-label="3-streampark--paimon-实践的直接链接" title="3-streampark--paimon-实践的直接链接">​</a></h2>
<p>接下来，我们将继续分享自如是如何基于 <strong>StreamPark + Paimon</strong> 进行架构优化改造的，我们先看架构升级前后的对比。</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="31-架构升级前"><strong>3.1 架构升级前</strong><a href="#31-架构升级前" class="hash-link" aria-label="31-架构升级前的直接链接" title="31-架构升级前的直接链接">​</a></h3>
<p>数据集成模块在改造之前的系统交互流程如下：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/system_interaction_process-0fa72272598ce1fbf180e4f859cf59dc.png" width="1080" height="291" class="img__KcZ"></p>
<p><strong>Step1</strong>（用户发起接入申请）：首先用户在数据接入平台选择一个表，然后点击申请接入按钮：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/data_access_platform-a2d62b477382c15128b76c60e9c6be53.png" width="1080" height="245" class="img__KcZ"></p>
<p><strong>Step2</strong>（发起OA系统审批流程）：OA 系统接收到接入申请，会发起工作流审批，如审批失败会驳回申请，审批通过才会继续下一步。</p>
<p><strong>Step3</strong>（数据接入平台处理审批通过事件）：数据接入平台调用 Canal 接口部署 Canal 任务，将表中的 Binlog 数据传入 Kafka ：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/canal_job-fbfcee343ac2473e1b22d199da463ad4.png" width="1041" height="760" class="img__KcZ"></p>
<p><strong>Step4</strong>（Flink 任务部署）：人工使用 Flink Session Submit UI 部署 Flink 模板作业，负责解析 Kafka 中的 Binlog 变化数据，并将数据写入 HDFS，同时映射成 Hive 外部增量表：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/flink_job-2769695ec6b0a9446b8d5f4828976b7d.png" width="946" height="331" class="img__KcZ"></p>
<p><strong>Step5</strong>（Airflow调度初始化表）：创建 Hive 映射增量表和全量表并用 Airflow 调度完成首次初始化:</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/first_initialization-f270b827e85b0ff840bf3db25686349c.png" width="1080" height="884" class="img__KcZ"></p>
<p><strong>Step6</strong>（数据合并到 Hive 全量表）：配置调度通过 Hive Merge 方式将 Hive 外部增量表的数据合并到 Hive 全量表中</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/data_merging-b8ac385c5de9f96c13163aa65e382496.png" width="1075" height="972" class="img__KcZ"></p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="32-架构升级后"><strong>3.2 架构升级后</strong><a href="#32-架构升级后" class="hash-link" aria-label="32-架构升级后的直接链接" title="32-架构升级后的直接链接">​</a></h3>
<p>改造后的系统交互流程图如下：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/after_the_transformation-8b3717c58b603d12e8e87c8267068672.png" width="1080" height="291" class="img__KcZ"></p>
<p>对比改造前和改造后的交互流程图，可以看出前两个步骤的流程（表接入申请与审批）是一样的，只是审批通过之后的事件<strong>监听处理方式</strong>的差异。</p>
<ul>
<li>
<p><strong>改造前</strong>：调用 Canal 接口去部署Canal 任务（旧的逻辑）；</p>
</li>
<li>
<p><strong>改造后</strong>：调用 StreamPark 的 API 接口完成 Flink Paimon 的任务部署。</p>
</li>
</ul>
<p>接下来看看使用 Paimon 来完成数据的集成的。</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="33-paimon-实现一键入-hive"><strong>3.3 Paimon 实现一键入 Hive</strong><a href="#33-paimon-实现一键入-hive" class="hash-link" aria-label="33-paimon-实现一键入-hive的直接链接" title="33-paimon-实现一键入-hive的直接链接">​</a></h3>
<p>在 Apache Paimon 0.5 版本后，提供了 CDC 数据集成能力，通过官方提供的 paimon-action jar 可以很方便的将 MySQL、Kafka、Mongo 等中的数据实时摄入到 Paimon 中，我们正在使用的是 paimon-flink-action ，采用了 <strong>mysql-sync-database（整库同步）</strong>，并通过“<strong>—including_tables</strong>” 参数选择要同步的表。这种同步模式有效地节省了大量资源开销，相比每个表启动一个 Flink 任务而言，避免了资源的大量浪费。</p>
<p>paimon-flink-action 提供了自动创建 Paimon 表的功能，并支持 Schema Evolution（例如，当 MySQL 表字段发生变化时，Paimon 表会相应变化，无需额外操作）。整个操作流程高效而顺畅，解决了原始架构因添加字段而产生的不必要运维成本，paimon-action 具体使用如下，更多请参考Paimon 官网文档。</p>
<div class="language-shell codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_IhPH"><pre tabindex="0" class="prism-code language-shell codeBlock_tTXe thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_qImF"><span class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;FLINK_HOME&gt;/bin/flink run \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /path/to/paimon-flink-action-0.8-SNAPSHOT.jar \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    mysql_sync_table</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    --warehouse &lt;warehouse-path&gt; \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    --database &lt;database-name&gt; \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    --table &lt;table-name&gt; \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--partition_keys &lt;partition_keys&gt;] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--primary_keys &lt;primary-keys&gt;] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--type_mapping &lt;option1,option2...&gt;] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--computed_column &lt;&#x27;column-name=expr-name(args[, ...])&#x27;&gt; [--computed_column ...]] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--metadata_column &lt;metadata-column&gt;] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--mysql_conf &lt;mysql-cdc-source-conf&gt; [--mysql_conf &lt;mysql-cdc-source-conf&gt; ...]] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--catalog_conf &lt;paimon-catalog-conf&gt; [--catalog_conf &lt;paimon-catalog-conf&gt; ...]] \</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    [--table_conf &lt;paimon-table-sink-conf&gt; [--table_conf &lt;paimon-table-sink-conf&gt; ...]]</span><br></span></code></pre><div class="buttonGroup_inAn"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_N8Av" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_EGLt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_gJas"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>引入 Paimon 后缩短了整个数据接入链路，消除了对 Canal、Kafka、Airflow 的依赖，使得 MySQL 直接以分钟级速度与 Hive 对接，整体环境清爽高效。此外，Paimon 完全兼容 Hive 端数据读取  ，转换成本极低，对原始架构脚本的使用也具备良好的兼容性，Paimon 还支持 Tag 功能，可以视为轻量级的快照，大幅降低了存储成本。</p>
<h3 class="anchor anchorWithStickyNavbar_myWT" id="34-streampark--paimon-落地实践"><strong>3.4 StreamPark + Paimon 落地实践</strong><a href="#34-streampark--paimon-落地实践" class="hash-link" aria-label="34-streampark--paimon-落地实践的直接链接" title="34-streampark--paimon-落地实践的直接链接">​</a></h3>
<p>StreamPark 在 2.1.2 版本中更好的支持了 JAR 类型的作业，使得 Paimon 类型的数据集成作业更简单了，下面的示例，演示了如何使用 StreamPark 快速开发 Paimon 数据迁移类型的作业：</p>
<p>//视频链接 (StreamPark 部署 Paimon 数据集成作业示例 )</p>
<p>诚然 StreamPark 在 2.1.2 版本之后已经特别针对 Paimon 数据集成类作业做了支持，但是这种手动创建作业，输入作业参数的方式还是不满足我们的实际需求，我们需要更灵活的作业创建，可以通过调用 API 的方式快速完成作业创建、启动... 经过我们的调研发现 StreamPark 已经完整的开放了作业的各项操作 API，如作业的复制、创建、部署、启动、停止等，这样一来，我们通过定时调度就可以非常方便和 StreamPark 组合，来快速完成作业的开发和运行，具体方式如下：</p>
<p><strong>Step1</strong>：首先，会调用api copy 模版接口，并传入参数，相关截图如下：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/api_copy-ceff34954a24abe2b3e04bc6d10d4f26.png" width="737" height="484" class="img__KcZ"></p>
<p>这样该作业就快速创建完成，参数会通过 copy 接口传入，具体参数如下：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/parameter-d7feafe0cd25f249bec4b2115d64ec00.png" width="780" height="959" class="img__KcZ"></p>
<p><strong>Step2</strong>：接着，调用api构建作业镜像：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/job_mirroring-8cbc7decc438aa15ca8166ba9a0bd7c1.png" width="870" height="522" class="img__KcZ"></p>
<p><strong>Step3</strong>：继续调用api启动作业：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/start_the_job-036fdf864d022cf8de2282af72d4b3ca.png" width="855" height="641" class="img__KcZ"></p>
<p>最后，任务启动成功后，可以在 StreamPark 平台看到任务的相关状态信息以及整体任务的资源概况：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/resource_overview-b7f0b5ccafd202f82c515c64e48cd377.png" width="1080" height="618" class="img__KcZ"></p>
<p>并可以点击Application Name 调度Flink Web UI：</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/flink_ui-1a5557a19b30e92802eab1b75cc4a574.png" width="1080" height="702" class="img__KcZ"></p>
<p>最后可以直接在 Hive 端查询 Paimon 表，获取所需的数据，其中 Paimon 表是经过 Flink 处理的、延时较低的数据同步目标表。Hue 中 Hive 查询 Paimon 表截图如下</p>
<p><img decoding="async" loading="lazy" src="/zh-CN/assets/images/hive_query_paimon-9203a5f6debb35ce41f9f51be06e1446.png" width="2000" height="1346" class="img__KcZ"></p>
<p>通过以上步骤，业务方可以方便地发起接入申请，经过审批流程后，通过 StreamPark 创建部署 Flink 作业，数据通过 Flink 作业入  Paimon 表，使用户能够轻松地在 Hive 端进行查询操作，整个流程简化了用户操作，提高了数据接入的效率和可维护性。</p>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="4-带来的收益"><strong>4. 带来的收益</strong><a href="#4-带来的收益" class="hash-link" aria-label="4-带来的收益的直接链接" title="4-带来的收益的直接链接">​</a></h2>
<p>自如通过使用 Paimon 和 StreamPark ，带来了如下优势和效益：</p>
<ul>
<li>
<p><strong>网络资源和数据库压力优化</strong>：通过直接从 Paimon 表获取数据快照，解决了凌晨从业务数据库拉取数据导致的网络资源紧张和数据库压力过大问题，同时降低了数据存储成本。</p>
</li>
<li>
<p><strong>作业管理接口提升效率</strong>：使用 StreamPark 的作业管理接口轻松解决了手动部署 Flink 任务的问题，消除了人员依赖时间导致任务不及时部署的情况，提高了效率，同时减少了沟通成本，提升了 Flink 作业的管理效率。</p>
</li>
<li>
<p><strong>降低开发、维护成本</strong>：解决了之前方案链路长导致的维护成本高和问题定位慢的问题，同时解决了字段变化导致的字段不一致问题，实现了数据接入的流批统一，降低了开发和维护的成本。</p>
</li>
<li>
<p><strong>降低了数据集成调度资源和计算资源的使用成本</strong>：不再依赖外部调度系统进行增量数据的合并，减少了调度资源的使用。也不再依赖 Hive 资源进行合并操作，降低了合并增量数据对 Hive 计算资源的花销成本。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_myWT" id="5-结语与期望"><strong>5. 结语与期望</strong><a href="#5-结语与期望" class="hash-link" aria-label="5-结语与期望的直接链接" title="5-结语与期望的直接链接">​</a></h2>
<p>我们衷心地感谢 <strong>Apache StreamPark</strong> 社区在我们使用 StreamPark API 时提供的无私帮助。他们专业的服务精神和以用户为本的态度，使我们得以更加高效、流畅地运用这一强大框架。作为一套卓越的框架，StreamPark 不但拥有出色的功能，而且能支持一系列如任务复制、创建、部署、启动、停止以及状态监控的操作，并在简化 Flink 任务的管理与维护方面显著地发挥了其价值。</p>
<p>同时，对 <strong>Apache Paimon</strong> 社区在自如 MySQL 入 Paimon 测试阶段给予我们的耐心与专业指导表示感谢，这是我们能够顺利完成测试的重要支持。Paimon 作为一项富有潜力的项目，无论是在功能实现还是团队协作方面，都展现了非凡的素质。</p>
<p>最后，我们对 Apache StreamPark 和 Apache Paimon 的未来之路满怀期待和信心，坚信它们能在未来会成为 Apache 的优秀项目。它们卓越的功能和和睦的社区合作模式，都为其在开源社区的成熟之路打下了坚实的基础。我们期待 StreamPark 和 Paimon 社区能一如既往地保持专业态度和良好的团队协作精神，不断推进项目发展，成为近年来新晋 Apache 项目的典范，以便对更广大的开发者社区产生更大的影响。</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_Wr5y"><div class="post-footer"><div class="col"><b>标签：</b><ul class="tags_bUDc padding--none margin-left--sm"><li class="tag_edSN"><a class="tag_mtSO tagRegular_u5wg" href="/zh-CN/blog/tags/stream-park">StreamPark</a></li><li class="tag_edSN"><a class="tag_mtSO tagRegular_u5wg" href="/zh-CN/blog/tags/生产实践">生产实践</a></li></ul></div><div class="col col-3 text--right"><a href="https://github.com/apache/incubator-streampark-website/edit/dev/blog/10-streampark-flink-with-paimon-in-ziru.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_WHnd" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div></div></footer></article></div></div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev paginationNavLink_UdUv" href="/zh-CN/blog/flink-development-framework-streampark"><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.2751 19.175L10.3251 18.125L5.4501 13.25H21.6001V11.75H5.4501L10.3251 6.87501L9.2751 5.82501L2.5751 12.5L9.2751 19.175Z" fill="currentColor"></path></svg><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">较新一篇</div><div class="paginationNavLabel_YPzM pagination-nav__label">Flink 开发利器 Apache StreamPark™</div></div></a><a class="pagination-nav__link pagination-nav__link--next paginationNavLink_UdUv" href="/zh-CN/blog/streampark-usercase-tianyancha"><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">较旧一篇</div><div class="paginationNavLabel_YPzM pagination-nav__label">Apache StreamPark™ 助力天眼查实时平台建设｜效率数倍提升</div></div><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7249 19.175L13.6749 18.125L18.5499 13.25H2.3999V11.75H18.5499L13.6749 6.87501L14.7249 5.82501L21.4249 12.5L14.7249 19.175Z" fill="currentColor"></path></svg></a></nav></main><div class="col col--2"><div class="tableOfContents_jeP5 thin-scrollbar" style="opacity:0;transform:translateX(100px) translateZ(0)"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1数据集成业务背景" class="table-of-contents__link toc-highlight"><strong>1.数据集成业务背景</strong></a></li><li><a href="#2遇到的挑战" class="table-of-contents__link toc-highlight"><strong>2.遇到的挑战</strong></a><ul><li><a href="#paimon-的核心特性" class="table-of-contents__link toc-highlight"><strong>Paimon 的核心特性</strong></a></li><li><a href="#streampark-的核心特性" class="table-of-contents__link toc-highlight"><strong>StreamPark 的核心特性</strong></a></li></ul></li><li><a href="#3-streampark--paimon-实践" class="table-of-contents__link toc-highlight"><strong>3. StreamPark + Paimon 实践</strong></a><ul><li><a href="#31-架构升级前" class="table-of-contents__link toc-highlight"><strong>3.1 架构升级前</strong></a></li><li><a href="#32-架构升级后" class="table-of-contents__link toc-highlight"><strong>3.2 架构升级后</strong></a></li><li><a href="#33-paimon-实现一键入-hive" class="table-of-contents__link toc-highlight"><strong>3.3 Paimon 实现一键入 Hive</strong></a></li><li><a href="#34-streampark--paimon-落地实践" class="table-of-contents__link toc-highlight"><strong>3.4 StreamPark + Paimon 落地实践</strong></a></li></ul></li><li><a href="#4-带来的收益" class="table-of-contents__link toc-highlight"><strong>4. 带来的收益</strong></a></li><li><a href="#5-结语与期望" class="table-of-contents__link toc-highlight"><strong>5. 结语与期望</strong></a></li></ul></div></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">加入社区</div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="subscribe-box btns">
                  <a class="btn btn-primary" href="https://github.com/apache/incubator-streampark"><i class="fa fa-github"></i><span>Github</span></a>
                  <a class="btn btn-primary" href="https://github.com/apache/incubator-streampark/issues"><i class="fa fa-slack"></i><span>Issue Tracking</span></a>
                  <a class="btn btn-primary" href="javascript:void(0)">
                    <i class="fa fa-wechat"></i>
                    <span>Wechat</span>
                    <div class="wechat-dropdown"><img src="/image/join_wechat.png" alt="weChat"></div>
                  </a>
                </div>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>
        <div>
          <div style="margin-bottom: 30px;">
            <a href="https://incubator.apache.org/" class="footerLogoLink" one-link-mark="yes">
              <img alt="Apache Incubator logo" class="footer__logo" width="200">
            </a>
          </div>
          <div>
            <p>
            Apache StreamPark is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </p>
          </div>
        </div>

        <div>
          <span>
            Copyright © 2022-2024 The Apache Software Foundation. Apache StreamPark, StreamPark, and its feather logo are trademarks of The Apache Software Foundation.
          </span>
        </div>
      </div></div></div></div></footer></div>
</body>
</html>