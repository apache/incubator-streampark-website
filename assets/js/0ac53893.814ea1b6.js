"use strict";(self.webpackChunkapache_streampark_website=self.webpackChunkapache_streampark_website||[]).push([[6667],{11654:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var s=r(86070),i=r(76113);const t={id:"flink-on-k8s",title:"Flink on Kubernetes",sidebar_position:1},o=void 0,a={id:"platform/k8s/flink-on-k8s",title:"Flink on Kubernetes",description:"StreamPark Flink Kubernetes is based on Flink Native Kubernetes and support deployment modes as below\uff1a",source:"@site/docs/platform/k8s/1.flink-on-k8s.md",sourceDirName:"platform/k8s",slug:"/platform/k8s/flink-on-k8s",permalink:"/docs/platform/k8s/flink-on-k8s",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/incubator-streampark-website/edit/dev/docs/platform/k8s/1.flink-on-k8s.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"flink-on-k8s",title:"Flink on Kubernetes",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"SSO Integration",permalink:"/docs/platform/sso"},next:{title:"Using Hadoop Resource in Flink on Kubernetes",permalink:"/docs/platform/k8s/hadoop-resource-integration"}},c={},l=[{value:"Environments requirement",id:"environments-requirement",level:2},{value:"Preparation for integration",id:"preparation-for-integration",level:2},{value:"configuration for connecting  Kubernetes",id:"configuration-for-connecting--kubernetes",level:3},{value:"configuration for coKubernetes RBAC",id:"configuration-for-cokubernetes-rbac",level:3},{value:"Configuration for remote Docker service",id:"configuration-for-remote-docker-service",level:3},{value:"Job submit",id:"job-submit",level:2},{value:"Application  Job release",id:"application--job-release",level:3},{value:"Session job release",id:"session-job-release",level:3},{value:"other configuration",id:"other-configuration",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["StreamPark Flink Kubernetes is based on ",(0,s.jsx)(n.a,{href:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/resource-providers/native_kubernetes/",children:"Flink Native Kubernetes"})," and support deployment modes as below\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Native-Kubernetes Application"}),"\n",(0,s.jsxs)(n.li,{children:["Native-Kubernetes Session\nAt now, one StreamPark only supports one Kubernetes cluster.You can submit ",(0,s.jsx)(n.a,{href:"https://github.com/apache/incubator-streampark/issues",children:"Fearure Request Issue"})," , when multiple Kubernetes clusters are needed."]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h2,{id:"environments-requirement",children:"Environments requirement"}),"\n",(0,s.jsx)(n.p,{children:"Additional operating environment to run StreamPark Flink-Kubernetes is as below:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Kubernetes"}),"\n",(0,s.jsx)(n.li,{children:"Maven\uff08StreamPark runNode\uff09"}),"\n",(0,s.jsx)(n.li,{children:"Docker\uff08StreamPark runNode\uff09"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["StreamPark entity can be deployed on Kubernetes nodes, and can also be deployed on node out of Kubernetes cluster when there are ",(0,s.jsx)(n.strong,{children:"smooth network"})," between the node and cluster."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h2,{id:"preparation-for-integration",children:"Preparation for integration"}),"\n",(0,s.jsx)(n.h3,{id:"configuration-for-connecting--kubernetes",children:"configuration for connecting  Kubernetes"}),"\n",(0,s.jsxs)(n.p,{children:["StreamPark connects to Kubernetes cluster by default connection credentials ",(0,s.jsx)(n.code,{children:"\uff5e/.kube/config "}),".User can copy ",(0,s.jsx)(n.code,{children:".kube/config"})," from  Kubernetes node to StreamPark nodes,or download it from Kubernetes provided by cloud service providers.If considering Permission constraints, User also can\ngenerate custom account`s  configuration by themselves."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl cluster-info\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-for-cokubernetes-rbac",children:"configuration for coKubernetes RBAC"}),"\n",(0,s.jsxs)(n.p,{children:["User can configure RBAC for Kubernetes Namespace by referring to Flink-Docs\uff1a",(0,s.jsx)(n.a,{href:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/resource-providers/native_kubernetes/#rbac",children:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/resource-providers/native_kubernetes/#rbac"})]}),"\n",(0,s.jsxs)(n.p,{children:["When Flink Namespace is ",(0,s.jsx)(n.code,{children:"flink-dev"})," and there are no needed to explicitly specify Kubernetes accounts, user can allocate resource to clusterrolebinding by the way as below"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl create clusterrolebinding flink-role-binding-default --clusterrole=edit --serviceaccount=flink-dev:default\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-for-remote-docker-service",children:"Configuration for remote Docker service"}),"\n",(0,s.jsx)(n.p,{children:"On Setting page of StreamPark, user can configure the connection information for Docker service of Kubernetes cluster."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"docker register setting",src:r(78343).A+"",width:"2616",height:"1980"})}),"\n",(0,s.jsxs)(n.p,{children:["Building a Namespace named ",(0,s.jsx)(n.code,{children:"streampark"}),"(other name should be set at Setting page of StreamPark) at remote Docker.The namespace is push/pull space of StreamPark Flink image and Docker Register User should own ",(0,s.jsx)(n.code,{children:"pull"}),"/",(0,s.jsx)(n.code,{children:"push"}),"  permission of this namespace."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# verify access\ndocker login --username=<your_username> <your_register_addr>\n# verify push permission\ndocker pull busybox\ndocker tag busybox <your_register_addr>/streampark/busybox\ndocker push <your_register_addr>/streampark/busybox\n# verify pull permission\ndocker pull <your_register_addr>/streampark/busybox\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h2,{id:"job-submit",children:"Job submit"}),"\n",(0,s.jsx)(n.h3,{id:"application--job-release",children:"Application  Job release"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"k8s application submit",src:r(31282).A+"",width:"2546",height:"1942"})}),"\n",(0,s.jsx)(n.p,{children:"parameter descriptions are as below\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flink Base Docker Image"}),"\uff1a Base Flink Docker Image Tag can be obtained from  ",(0,s.jsx)(n.a,{href:"https://hub.docker.com/_/flink",children:"DockerHub - offical/flink"})," .And user can also use private image when Docker Register Account owns ",(0,s.jsx)(n.code,{children:"pull"})," permission of it."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rest-Service Exposed Type"}),"\uff1aDescription of candidate values for native Flink Kubernetes configuration ",(0,s.jsx)(n.a,{href:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/config/#kubernetes",children:"kubernetes.rest-service.exposed.type"})," \uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ClusterIP"}),"\uff1aip that StreamPark can access\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"LoadBalancer"}),"\uff1aresource of LoadBalancer should be allocated in advance\uff0c Flink Namespace own permission of automatic binding\uff0cand StreamPark can access LoadBalancer`s gateway\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"NodePort"}),"\uff1aStreamPark can access  all Kubernetes nodes\uff1b"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Kubernetes Pod Template"}),": This is Flink's custom configuration of pod-template. The ",(0,s.jsx)(n.code,{children:"container-name"})," must be ",(0,s.jsx)(n.code,{children:"flink-main-container"}),". If the Kubernetes pod needs a secret key to pull the Docker image, please fill in the information about\nthe secret key in the pod template file. Below is an example of pod-template:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-template\nspec:\n  serviceAccount: default\n  containers:\n  - name: flink-main-container\n    image:\n  imagePullSecrets:\n  - name: regsecret\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Dynamic Option"}),": Dynamic options of Flink on Kubernetes (part of parameters can also be defined in pod-template). Options should start with ",(0,s.jsx)(n.code,{children:"-D"}),". Details can be found at ",(0,s.jsx)(n.a,{href:"https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/deployment/config/#kubernetes",children:"Flink on Kubernetes parameters"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"After the job is started, it is supported to directly access the corresponding Flink Web UI page on the Detail page of the task\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"k8s app detail",src:r(49964).A+"",width:"2542",height:"1946"})}),"\n",(0,s.jsx)(n.h3,{id:"session-job-release",children:"Session job release"}),"\n",(0,s.jsxs)(n.p,{children:["The additional configuration of Flink-Native-Kubernetes Session Job will be decided by Flink-Session cluster.More details can be find in Flink-Doc\uff1a",(0,s.jsx)(n.a,{href:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/resource-providers/native_kubernetes",children:"https://ci.apache.org/projects/flink/flink-docs-stable/docs/deployment/resource-providers/native_kubernetes"})]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h2,{id:"other-configuration",children:"other configuration"}),"\n",(0,s.jsxs)(n.p,{children:["StreamPark parameters related to Flink-Kubernetes in ",(0,s.jsx)(n.code,{children:"applicaton.yml"})," are as below. And in most conditions, there is no need to change it."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Configuration item"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Default value"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.docker.register.image-namespace"}),(0,s.jsx)(n.td,{children:"namespace of Remote docker service repository\uff0c flink-job image will be pushed here"}),(0,s.jsx)(n.td,{children:"null"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.flink-k8s.tracking.polling-task-timeout-sec.job-status"}),(0,s.jsx)(n.td,{children:"timeout in seconds of flink state tracking task"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.flink-k8s.tracking.polling-task-timeout-sec.cluster-metric"}),(0,s.jsx)(n.td,{children:"timeout in seconds of flink metrics tracking task"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.flink-k8s.tracking.polling-interval-sec.job-status"}),(0,s.jsx)(n.td,{children:"interval in seconds of flink state tracking task.To maintain accuracy, please set below 5s, the best setting is 2-3s"}),(0,s.jsx)(n.td,{children:"5"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.flink-k8s.tracking.polling-interval-sec.cluster-metric"}),(0,s.jsx)(n.td,{children:"interval in seconds of flink metrics tracking task"}),(0,s.jsx)(n.td,{children:"10"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"streampark.flink-k8s.tracking.silent-state-keep-sec"}),(0,s.jsx)(n.td,{children:"fault tolerance time in seconds of  silent  metrics"}),(0,s.jsx)(n.td,{children:"60"})]})]})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},78343:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/docker_register_setting-55ff0f03235a1708b428b016d8ccc8a2.png"},49964:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/k8s_app_detail-5ee71eb0d0e20f2c6e3009e98b3d63db.png"},31282:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/k8s_application_submit-7d2a3d17220cc3048b6d5b22184f9afc.png"},76113:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(30758);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);